<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue-loader原理分析 | Alan的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="本文主要介绍vue-loader原理分析

vue-loader原理分析

如何调试vue-loader
1. 使用vue-cli初始化项目
$ vue create hello-world

// 运行环境
vue-c ...">
    
    <link rel="preload" href="/assets/css/0.styles.89986362.css" as="style"><link rel="preload" href="/assets/js/app.17a065d5.js" as="script"><link rel="preload" href="/assets/js/13.dfa639c4.js" as="script"><link rel="preload" href="/assets/js/3.cc50076e.js" as="script"><link rel="preload" href="/assets/js/19.efbb3b9c.js" as="script"><link rel="prefetch" href="/assets/js/10.32b9865d.js"><link rel="prefetch" href="/assets/js/11.9a553ac3.js"><link rel="prefetch" href="/assets/js/12.168b3c96.js"><link rel="prefetch" href="/assets/js/14.52e663a8.js"><link rel="prefetch" href="/assets/js/15.5f783ef3.js"><link rel="prefetch" href="/assets/js/16.7576f9d2.js"><link rel="prefetch" href="/assets/js/17.43eb5390.js"><link rel="prefetch" href="/assets/js/18.4af0c97b.js"><link rel="prefetch" href="/assets/js/20.d33fd6a6.js"><link rel="prefetch" href="/assets/js/21.f7215a74.js"><link rel="prefetch" href="/assets/js/22.5737c2db.js"><link rel="prefetch" href="/assets/js/23.7d46d7b0.js"><link rel="prefetch" href="/assets/js/24.e5eef3dd.js"><link rel="prefetch" href="/assets/js/25.40953362.js"><link rel="prefetch" href="/assets/js/26.f8bed2f5.js"><link rel="prefetch" href="/assets/js/27.4ffff4ac.js"><link rel="prefetch" href="/assets/js/28.af1c6adc.js"><link rel="prefetch" href="/assets/js/29.06a4d4f9.js"><link rel="prefetch" href="/assets/js/30.b3bd9ce9.js"><link rel="prefetch" href="/assets/js/31.9dd76f20.js"><link rel="prefetch" href="/assets/js/32.921e7724.js"><link rel="prefetch" href="/assets/js/33.12aaa7ed.js"><link rel="prefetch" href="/assets/js/34.396cd815.js"><link rel="prefetch" href="/assets/js/35.02ec910f.js"><link rel="prefetch" href="/assets/js/36.b3075e00.js"><link rel="prefetch" href="/assets/js/37.545af8cb.js"><link rel="prefetch" href="/assets/js/38.ce05662d.js"><link rel="prefetch" href="/assets/js/39.55292b7f.js"><link rel="prefetch" href="/assets/js/4.207d7112.js"><link rel="prefetch" href="/assets/js/40.043f8a84.js"><link rel="prefetch" href="/assets/js/41.c7aafeb8.js"><link rel="prefetch" href="/assets/js/42.89cc1975.js"><link rel="prefetch" href="/assets/js/43.a934551c.js"><link rel="prefetch" href="/assets/js/44.c78c0dd6.js"><link rel="prefetch" href="/assets/js/45.c3fa5679.js"><link rel="prefetch" href="/assets/js/46.d0996971.js"><link rel="prefetch" href="/assets/js/47.7d8bddb0.js"><link rel="prefetch" href="/assets/js/48.a742a296.js"><link rel="prefetch" href="/assets/js/49.c03242bd.js"><link rel="prefetch" href="/assets/js/5.f5134626.js"><link rel="prefetch" href="/assets/js/50.4deb0ee1.js"><link rel="prefetch" href="/assets/js/51.4f00a346.js"><link rel="prefetch" href="/assets/js/6.90befd16.js"><link rel="prefetch" href="/assets/js/7.1ca39d72.js"><link rel="prefetch" href="/assets/js/8.f25e7d9b.js"><link rel="prefetch" href="/assets/js/9.c5604d33.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.6dcb9fe5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.89986362.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Alan的博客 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">博客</a></li><li class="nav-item"><a href="/tag/" class="nav-link">标签</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Alan的博客 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">博客</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">标签</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        vue-loader原理分析
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">Alan</span> <span itemprop="address">   in Shanghai</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2023-03-24T00:00:00.000Z">
      Fri Mar 24 2023
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/webpack" data-v-42ccfcd5><span data-v-42ccfcd5>webpack</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/vue-loader" data-v-42ccfcd5><span data-v-42ccfcd5>vue-loader</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/loader" data-v-42ccfcd5><span data-v-42ccfcd5>loader</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/原理分析" data-v-42ccfcd5><span data-v-42ccfcd5>原理分析</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>本文主要介绍vue-loader原理分析</p> <h2 id="vue-loader原理分析"><a href="#vue-loader原理分析" class="header-anchor">#</a> vue-loader原理分析</h2> <h3 id="如何调试vue-loader"><a href="#如何调试vue-loader" class="header-anchor">#</a> 如何调试vue-loader</h3> <h4 id="_1-使用vue-cli初始化项目"><a href="#_1-使用vue-cli初始化项目" class="header-anchor">#</a> 1. 使用vue-cli初始化项目</h4> <div class="language-js extra-class"><pre class="language-js"><code>$ vue create hello<span class="token operator">-</span>world
</code></pre></div><img src="/assets/img/1.d996322b.png"> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 运行环境</span>
vue<span class="token operator">-</span>cli<span class="token operator">:</span> @vue<span class="token operator">/</span>cli <span class="token number">4.5</span><span class="token number">.15</span>
<span class="token literal-property property">vue</span><span class="token operator">:</span> <span class="token number">2.6</span><span class="token number">.11</span>
</code></pre></div><h4 id="_2-运行调试命令"><a href="#_2-运行调试命令" class="header-anchor">#</a> 2. 运行调试命令</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// chrome调试方式</span>
$ node <span class="token operator">--</span>inspect<span class="token operator">-</span>brk <span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span><span class="token punctuation">.</span>bin<span class="token operator">/</span>webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server
</code></pre></div><p>如下图出现红框中绿色按钮，即可调试node
<img src="/assets/img/2.4012c8a0.png"></p> <h4 id="_3-配置webpack"><a href="#_3-配置webpack" class="header-anchor">#</a> 3. 配置webpack</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-添加debugger"><a href="#_4-添加debugger" class="header-anchor">#</a> 4. 添加debugger</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue-loader文件添加debugger</span>
<span class="token comment">// node_modules/_vue-loader@13.7.3@vue-loader/lib/loader.js</span>
<span class="token punctuation">{</span>
  module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">debugger</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token comment">// ......</span>
    <span class="token keyword">return</span>  output<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="vue-loader返回的字符串"><a href="#vue-loader返回的字符串" class="header-anchor">#</a> vue-loader返回的字符串</h4> <p>vue-loader/lib/selector 根据类型(template, script, css)返回标签里内容</p> <ol><li>只有template</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> disposed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token comment">// 定义标准化组件方法</span>
<span class="token comment">// normalizeComponent</span>
<span class="token comment">// 返回Vue实例化可选项， 同时配置render, staticRenderFns</span>
<span class="token comment">/**
 * @return {esModule:esModule,exports:scriptExports,options:options}
 * options包含Vue实例化可选项和render函数
 */</span>
<span class="token keyword">var</span> normalizeComponent <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;!../node_modules/_vue-loader@13.7.3@vue-loader/lib/component-normalizer&quot;</span><span class="token punctuation">)</span>
<span class="token comment">/* script */</span>
<span class="token keyword">var</span> __vue_script__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">/* template */</span>
<span class="token comment">// 执行顺序： 从右到左 （import from中!!没有优先级）</span>
<span class="token comment">// !! 禁止内联loader外的其它loader的执行(内联loader从左到右执行，避免重复执行loader)，最后一个元素是要加载的资源</span>
<span class="token comment">// lib/selector =&gt; template-compiler/index</span>
<span class="token comment">// 1. 获取template内容 lib/selector  ps: this.callback同步返回数据</span>
<span class="token comment">// 2. 生成render函数 template-compiler/index</span>
<span class="token comment">// 3. __vue_template__ =&gt; {render: Function, staticRenderFns: []}</span>
<span class="token comment">/**
* @return {render: Function, staticRenderFns: []}
*/</span>
<span class="token keyword">import</span> __vue_template__ <span class="token keyword">from</span> <span class="token string">&quot;!!../node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler/index?{}!../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=template&amp;index=0!./App.vue&quot;</span>
<span class="token comment">/* template functional */</span>
<span class="token keyword">var</span> __vue_template_functional__ <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token comment">/* styles */</span>
<span class="token keyword">var</span> __vue_styles__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">/* scopeId */</span>
<span class="token keyword">var</span> __vue_scopeId__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">/* moduleIdentifier (server only) */</span>
<span class="token keyword">var</span> __vue_module_identifier__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">var</span> Component <span class="token operator">=</span> <span class="token function">normalizeComponent</span><span class="token punctuation">(</span>
  __vue_script__<span class="token punctuation">,</span>
  __vue_template__<span class="token punctuation">,</span>
  __vue_template_functional__<span class="token punctuation">,</span>
  __vue_styles__<span class="token punctuation">,</span>
  __vue_scopeId__<span class="token punctuation">,</span>
  __vue_module_identifier__
<span class="token punctuation">)</span>
Component<span class="token punctuation">.</span>options<span class="token punctuation">.</span>__file <span class="token operator">=</span> <span class="token string">&quot;src/App.vue&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Component<span class="token punctuation">.</span>exports
</code></pre></div><ol start="2"><li>只有script</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> disposed <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">var</span> normalizeComponent <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;!../node_modules/_vue-loader@13.7.3@vue-loader/lib/component-normalizer&quot;</span><span class="token punctuation">)</span>
<span class="token comment">/* script */</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&quot;!!babel-loader!../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&amp;index=0!./App.vue&quot;</span>
<span class="token comment">// 执行顺序： 从右到左 （import from中!!没有优先级）</span>
<span class="token comment">// lib/selector =&gt; babel-loader</span>
<span class="token comment">// 1. 获取script内容 lib/selector</span>
<span class="token comment">// 2. script标签内容转换为js对象 babel-loader</span>
<span class="token comment">/**
 * @return {name: '', data: Function} Vue可选项
 */</span>
<span class="token keyword">import</span> __vue_script__ <span class="token keyword">from</span> <span class="token string">&quot;!!babel-loader!../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&amp;index=0!./App.vue&quot;</span>
<span class="token comment">/* template */</span>
<span class="token keyword">var</span> __vue_template__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">/* template functional */</span>
<span class="token keyword">var</span> __vue_template_functional__ <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token comment">/* styles */</span>
<span class="token keyword">var</span> __vue_styles__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">/* scopeId */</span>
<span class="token keyword">var</span> __vue_scopeId__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">/* moduleIdentifier (server only) */</span>
<span class="token keyword">var</span> __vue_module_identifier__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">var</span> Component <span class="token operator">=</span> <span class="token function">normalizeComponent</span><span class="token punctuation">(</span>
  __vue_script__<span class="token punctuation">,</span>
  __vue_template__<span class="token punctuation">,</span>
  __vue_template_functional__<span class="token punctuation">,</span>
  __vue_styles__<span class="token punctuation">,</span>
  __vue_scopeId__<span class="token punctuation">,</span>
  __vue_module_identifier__
<span class="token punctuation">)</span>
Component<span class="token punctuation">.</span>options<span class="token punctuation">.</span>__file <span class="token operator">=</span> <span class="token string">&quot;src/App.vue&quot;</span>
</code></pre></div><ol start="3"><li>只有style</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">injectStyle</span> <span class="token punctuation">(</span><span class="token parameter">ssrContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 执行顺序： 从右到左 （require中!!更高优先级）</span>
  <span class="token comment">// 1. 把css插入到dom中 vue-style-loader(先生成dom插入函数)，fork来自style-loader</span>
  <span class="token comment">// 2. 获取style内容 lib/selector</span>
  <span class="token comment">// 3. 去掉style标签内空格和生成css对象 style-compiler/index</span>
  <span class="token comment">// 4. 导出css对象 css-loader</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;!!vue-loader/node_modules/vue-style-loader!css-loader?sourceMap!../node_modules/_vue-loader@13.7.3@vue-loader/lib/style-compiler/index?{\&quot;vue\&quot;:true,\&quot;id\&quot;:\&quot;data-v-7ba5bd90\&quot;,\&quot;scoped\&quot;:false,\&quot;hasInlineConfig\&quot;:false}!../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=styles&amp;index=0!./App.vue&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> normalizeComponent <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;!../node_modules/_vue-loader@13.7.3@vue-loader/lib/component-normalizer&quot;</span><span class="token punctuation">)</span>
<span class="token comment">/* script */</span>
<span class="token keyword">var</span> __vue_script__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">/* template */</span>
<span class="token keyword">var</span> __vue_template__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">/* template functional */</span>
<span class="token keyword">var</span> __vue_template_functional__ <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token comment">/* styles */</span>
<span class="token keyword">var</span> __vue_styles__ <span class="token operator">=</span> injectStyle
<span class="token comment">/* scopeId */</span>
<span class="token keyword">var</span> __vue_scopeId__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">/* moduleIdentifier (server only) */</span>
<span class="token keyword">var</span> __vue_module_identifier__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">var</span> Component <span class="token operator">=</span> <span class="token function">normalizeComponent</span><span class="token punctuation">(</span>
  __vue_script__<span class="token punctuation">,</span>
  __vue_template__<span class="token punctuation">,</span>
  __vue_template_functional__<span class="token punctuation">,</span>
  __vue_styles__<span class="token punctuation">,</span>
  __vue_scopeId__<span class="token punctuation">,</span>
  __vue_module_identifier__
<span class="token punctuation">)</span>
Component<span class="token punctuation">.</span>options<span class="token punctuation">.</span>__file <span class="token operator">=</span> <span class="token string">&quot;src/App.vue&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Component<span class="token punctuation">.</span>exports
</code></pre></div><p>3.1 vue-style-loader解析后
新增style标签到DOM中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// style-loader: Adds some css to the DOM by adding a &lt;style&gt; tag</span>

<span class="token comment">// load the styles</span>
<span class="token keyword">var</span> content <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;!!../node_modules/_css-loader@0.28.11@css-loader/index.js?sourceMap!../node_modules/_vue-loader@13.7.3@vue-loader/lib/style-compiler/index.js?{\&quot;vue\&quot;:true,\&quot;id\&quot;:\&quot;data-v-7ba5bd90\&quot;,\&quot;scoped\&quot;:false,\&quot;hasInlineConfig\&quot;:false}!../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector.js?type=styles&amp;index=0!./App.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> content <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> content <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span>locals<span class="token punctuation">)</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> content<span class="token punctuation">.</span>locals<span class="token punctuation">;</span>
<span class="token comment">// style插入到DOM</span>
<span class="token keyword">var</span> update <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;!../node_modules/_vue-style-loader@3.1.2@vue-style-loader/lib/addStylesClient.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;41c9429e&quot;</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 热更新</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// When the styles change, update the &lt;style&gt; tags</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>content<span class="token punctuation">.</span>locals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">&quot;!!../node_modules/_css-loader@0.28.11@css-loader/index.js&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">update</span><span class="token punctuation">(</span>newContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// When the module is disposed, remove the &lt;style&gt; tags</span>
 module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3.2 css-loader解析后</p> <div class="language-js extra-class"><pre class="language-js"><code>exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../node_modules/_css-loader@0.28.11@css-loader/lib/css-base.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// imports</span>
<span class="token comment">// module</span>
exports<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">&quot;\nh1 {\n  color: yellowgreen\n}\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string-property property">&quot;sources&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;/Users/alanliang/project/vue-analysis/vue-webpack-simple/src/src/App.vue&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string-property property">&quot;names&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token string">&quot;;AAGA;EACA,kBAAA;CACA&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;file&quot;</span><span class="token operator">:</span><span class="token string">&quot;App.vue&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;sourcesContent&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;\n\n&lt;style lang=\&quot;css\&quot;&gt;\n  h1 {\n    color: yellowgreen\n  }\n&lt;/style&gt;\n&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string-property property">&quot;sourceRoot&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// exports</span>
</code></pre></div><h4 id="解析过程分析"><a href="#解析过程分析" class="header-anchor">#</a> 解析过程分析</h4> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- app.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'Welcome to Vue.js App'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">h1</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> yellowgreen
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="_1-把组件标签解析成对象template-script-css"><a href="#_1-把组件标签解析成对象template-script-css" class="header-anchor">#</a> 1. 把组件标签解析成对象template/script/css</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./vue-template-compiler/index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * @returns {
    template: {&quot;type&quot;:&quot;template&quot;,&quot;content&quot;:&quot;&quot;,&quot;start&quot;:10,&quot;end&quot;:60,&quot;attrs&quot;:{}},
    script: {&quot;type&quot;:&quot;template&quot;,&quot;content&quot;:&quot;&quot;,&quot;start&quot;:10,&quot;end&quot;:60,&quot;attrs&quot;:{}},
    css: {&quot;type&quot;:&quot;template&quot;,&quot;content&quot;:&quot;&quot;,&quot;start&quot;:10,&quot;end&quot;:60,&quot;attrs&quot;:{}},
  }
 */</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> needMap<span class="token punctuation">,</span> sourceRoot<span class="token punctuation">,</span> needCSSMap</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> output <span class="token operator">=</span> compiler<span class="token punctuation">.</span><span class="token function">parseComponent</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">pad</span><span class="token operator">:</span> <span class="token string">'line'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> output<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> disposed <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">function</span> <span class="token function">injectStyle</span> <span class="token punctuation">(</span><span class="token parameter">ssrContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>disposed<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;!!vue-loader/node_modules/vue-style-loader!css-loader?sourceMap!../node_modules/_vue-loader@13.7.3@vue-loader/lib/style-compiler/index?{}!../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=styles&amp;index=0!./App.vue&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> normalizeComponent <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;!../node_modules/_vue-loader@13.7.3@vue-loader/lib/component-normalizer&quot;</span><span class="token punctuation">)</span>
<span class="token comment">/* script */</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&quot;!!babel-loader!../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&amp;index=0!./App.vue&quot;</span>
<span class="token keyword">import</span> __vue_script__ <span class="token keyword">from</span> <span class="token string">&quot;!!babel-loader!../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&amp;index=0!./App.vue&quot;</span>
<span class="token comment">/* template */</span>
<span class="token keyword">import</span> __vue_template__ <span class="token keyword">from</span> <span class="token string">&quot;!!../node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler/index?{}!../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=template&amp;index=0!./App.vue&quot;</span>
<span class="token comment">/* template functional */</span>
<span class="token keyword">var</span> __vue_template_functional__ <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token comment">/* styles */</span>
<span class="token keyword">var</span> __vue_styles__ <span class="token operator">=</span> injectStyle
<span class="token comment">/* scopeId */</span>
<span class="token keyword">var</span> __vue_scopeId__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">/* moduleIdentifier (server only) */</span>
<span class="token keyword">var</span> __vue_module_identifier__ <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">var</span> Component <span class="token operator">=</span> <span class="token function">normalizeComponent</span><span class="token punctuation">(</span>
  __vue_script__<span class="token punctuation">,</span>
  __vue_template__<span class="token punctuation">,</span>
  __vue_template_functional__<span class="token punctuation">,</span>
  __vue_styles__<span class="token punctuation">,</span>
  __vue_scopeId__<span class="token punctuation">,</span>
  __vue_module_identifier__
<span class="token punctuation">)</span>
Component<span class="token punctuation">.</span>options<span class="token punctuation">.</span>__file <span class="token operator">=</span> <span class="token string">&quot;src/App.vue&quot;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Component<span class="token punctuation">.</span>exports
</code></pre></div><h5 id="_2-根据type类型分发不同的编译器"><a href="#_2-根据type类型分发不同的编译器" class="header-anchor">#</a> 2. 根据type类型分发不同的编译器</h5> <p><code>vue-loader\lib\selector</code>根据类型分发不同的编译器</p> <ul><li>2.1 处理template
<code>vue-loader\lib\selector?type=template</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 编译template模版， 返回render函数</span>
template<span class="token operator">-</span>compiler<span class="token operator">/</span>index
</code></pre></div><ul><li>2.2 处理script
<code>vue-loader\lib\selector?type=script</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 编译script标签内容， 这儿可以配置babel, 编译成es5</span>
babel<span class="token operator">-</span>loader
</code></pre></div><ul><li>2.3 处理style
<code>vue-loader\lib\selector?type=styles</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>style<span class="token operator">-</span>compiler<span class="token operator">/</span>index  <span class="token comment">// 编译style标签内容为css-loader需要的格式</span>
css<span class="token operator">-</span>loader  <span class="token comment">// 生成css对象， style-loader需要的格式对象</span>
vue<span class="token operator">-</span>style<span class="token operator">-</span>loader   <span class="token comment">// 类似style-loader，把style插入到DOM中</span>
</code></pre></div></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#vue-loader原理分析" title="vue-loader原理分析">vue-loader原理分析</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#如何调试vue-loader" title="如何调试vue-loader">如何调试vue-loader</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.17a065d5.js" defer></script><script src="/assets/js/13.dfa639c4.js" defer></script><script src="/assets/js/3.cc50076e.js" defer></script><script src="/assets/js/19.efbb3b9c.js" defer></script>
  </body>
</html>

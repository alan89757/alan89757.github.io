<!DOCTYPE html>
<html lang="zh-CN">


<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>
    webpack入门到精通 | Alan的学习曲线
  </title>
  <meta name="description" content="">
  
  <meta name="keywords" content="
  webpack
  ">
  
  <meta name="author" content="Alan">

  <meta http-equiv="Cache-Control" content="no-transform"/>
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="theme-color" content="#1e2327">
  <link rel="apple-touch-icon" href="https://github.githubassets.com/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://github.githubassets.com/apple-touch-icon-180x180.png">

  <link rel="icon" type="image/x-icon" href="https://github.githubassets.com/favicon.ico">
  <link rel="stylesheet" href="/css/main.css">
  <!-- <link rel="stylesheet"
        href="/css/font-awesome.min.css"> -->
  

  

  <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script> -->
  <!-- <script src="http://localhost:4000/js/moment.min.js"></script> -->
  <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script> -->
  <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script> -->
  <script src="/js/vue.min.js"></script>
  <script src="/js/moment.min.js"></script>
<meta name="generator" content="Hexo 6.3.0"></head>

<body id="replica-app">

<nav class="navbar-wrapper">
  <div class="navbar">
    <div class="container clearfix">
      <a href="/" class="navbar-logo"><i class="fa fa-github"></i></a>

      <div class="navbar-search float-left desktop-only">
        <div class="navbar-search-form">
          <label for="gsc-i-id1">站内搜索</label>
          <div id="google-search">
            <gcse:search></gcse:search>
          </div>
        </div>
      </div>

      <ul class="navbar-nav float-left">
        
        <li><a href="/archives">Archives</a></li>
        
        
        <li><a href="/categories">Categories</a></li>
        
        
        <li><a href="/tags">Tags</a></li>
        
        
        <!-- <li class="desktop-only"><a href="/atom.xml" target="_blank">RSS</a></li> -->
        
      </ul>

      <ul class="navbar-nav user-nav float-right desktop-only">
        <li class="user-nav-notification">
          <a><span class="user-nav-unread"></span><i class="fa fa-bell"></i></a>
        </li>
        <li>
          <a><i class="fa fa-plus"></i> <i class="fa fa-caret-down"></i></a>
        </li>
        <li class="user-nav-logo">
          <a><img src="/images/baracktocat.png"> <i class="fa fa-caret-down"></i></i></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="main-container">
  <header class="header-wrapper desktop-only">
  <div class="container header-site-detail">
    <ul class="header-toolbar">
      <li class="clearfix">
        <a href="/archives" class="header-toolbar-left"><i
                  class="fa fa-file-text"></i> Posts </a>
        <a href="/archives"
           class="header-toolbar-right"> 43 </a>
      </li>
      <li>
        <a href="/tags" class="header-toolbar-left"><i
                  class="fa fa-tags"></i> Tags </a>
        <a href="/tags"
           class="header-toolbar-right"> 50 </a>
      </li>
      <li>
        <a href="/categories" class="header-toolbar-left"><i
                  class="fa fa-folder-open"></i> Categories </a>
        <a href="/categories"
           class="header-toolbar-right"> 18 </a>
      </li>
    </ul>
    <h2 class="header-title">
      <i class="fa fa-book text-muted"></i>
      <a href="/">Alan的学习曲线</a>
      
      
    </h2>
  </div>

  <!-- <div class="container">
    <div class="header-tab-wrapper clearfix">
      <span class="header-tab header-tab-selected"><i class="fa fa-thumbs-o-up"></i> Like</span>
      <span class="header-tab"><i class="fa fa-share-alt"></i> Share</span>
      <span class="header-tab"><i class="fa fa-comments-o"></i> Discussion</span>
      <span class="header-tab"><i class="fa fa-bookmark-o"></i> Bookmark </span>
      <span class="header-tab"><i class="fa fa-smile-o"></i> Smile <i class="fa fa-caret-down"></i></span>
    </div>
  </div> -->
</header>


<div class="post-container container">
  <h3>
    <i class="fa fa-user-o"></i>
    Alan

    <span class="post-date float-right" title="{{moment(1647014400000).format('MMM DD, YYYY, h:mm:ss A')}}">
      
          <i class="fa fa-pencil-square-o"></i>
      
      {{moment(1647014400000).fromNow()}}
    </span>
  </h3>

  <article class="post-content">
    <h1>webpack入门到精通</h1>
    <p>细数现今最流行的打包工具，非webpack莫属~</p>
<span id="more"></span>

<h3 id="对比-webpack-gulp-grunt"><a href="#对比-webpack-gulp-grunt" class="headerlink" title="对比 webpack gulp grunt"></a>对比 webpack gulp grunt</h3><p>webpack v1.x  2014.02<br>webpack v2.x  2017.01<br>webpack v3.x  2017.06<br>webpack v4.x  4.32.2   &#x2F;&#x2F; 2018 02 正式版<br>webpack v5.x  v5.50.0   &#x2F;&#x2F; 2020 10 正式版</p>
<h3 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h3><h4 id="先介绍下jQuery的写法"><a href="#先介绍下jQuery的写法" class="headerlink" title="先介绍下jQuery的写法"></a>先介绍下jQuery的写法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">----------------------jQuery-------------------</span><br><span class="line"><span class="title function_">jQuery</span>(<span class="keyword">function</span>(<span class="params">root</span>)&#123;</span><br><span class="line">  root.<span class="property">jQuery</span>=&#123;&#125;</span><br><span class="line">&#125;)(<span class="variable language_">window</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>命名空间<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj=&#123;&#125;</span><br><span class="line">obj.<span class="property">dev</span> = obj.<span class="property">dev</span> || &#123;&#125;</span><br><span class="line">obj.<span class="property">dev</span>.<span class="property">method</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">obj.<span class="property">dev</span>.<span class="property">add</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">obj.<span class="property">dev</span>.<span class="property">sub</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line">obj.<span class="property">sale</span> = obj.<span class="property">sale</span> || &#123;&#125;</span><br><span class="line">obj.<span class="property">sale</span>.<span class="property">remove</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">obj.<span class="property">sale</span>.<span class="property">append</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="AMD和CMD"><a href="#AMD和CMD" class="headerlink" title="AMD和CMD"></a>AMD和CMD</h4><ul>
<li><p>amd<br>全称：Asynchronous Module Definition<br><a target="_blank" rel="noopener" href="https://github.com/amdjs/amdjs-api/wiki/AMD">AMD</a> 是 RequireJS 在推广过程中对模块定义的规范化产出</p>
</li>
<li><p>cmd<br>全称： Common Module Definition<br><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/242">CMD</a> 是 SeaJS 在推广过程中对模块定义的规范化产出</p>
</li>
</ul>
<h5 id="amd和cmd的区别："><a href="#amd和cmd的区别：" class="headerlink" title="amd和cmd的区别："></a>amd和cmd的区别：</h5><ol>
<li>对于依赖的模块，AMD 是提前执行，CMD 是延迟执行。不过 RequireJS 从 2.0 开始，<br>也改成可以延迟执行（根据写法不同，处理方式不同）。CMD 推崇 as lazy as possible.</li>
<li>CMD 推崇依赖就近，AMD 推崇依赖前置</li>
</ol>
<p>代码示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CMD  seajs</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line">   <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a&#x27;</span>);</span><br><span class="line">   a.<span class="title function_">doSomething</span>();   </span><br><span class="line">   <span class="comment">// 此处略去 100 行   </span></span><br><span class="line">   <span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;./b&#x27;</span>); <span class="comment">// 依赖可以就近书写   </span></span><br><span class="line">   b.<span class="title function_">doSomething</span>();   <span class="comment">// </span></span><br><span class="line">  ... </span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// AMD requirejs 默认推荐的是</span></span><br><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;./a&#x27;</span>, <span class="string">&#x27;./b&#x27;</span>], <span class="keyword">function</span>(<span class="params">a, b</span>) &#123;  </span><br><span class="line">  <span class="comment">// 依赖必须一开始就写好    </span></span><br><span class="line">  a.<span class="title function_">doSomething</span>();    </span><br><span class="line">  <span class="comment">// 此处略去 100 行    </span></span><br><span class="line">  b.<span class="title function_">doSomething</span>();    </span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="commonJS和es6-Module-es6模块化"><a href="#commonJS和es6-Module-es6模块化" class="headerlink" title="commonJS和es6 Module(es6模块化)"></a>commonJS和es6 Module(es6模块化)</h4><ul>
<li>commonjs<br>应用场景： nodejs</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> <span class="comment">// 导出</span></span><br><span class="line"><span class="built_in">require</span>  <span class="comment">//导入</span></span><br></pre></td></tr></table></figure>

<ul>
<li>es6 Module<br>应用场景： nodejs</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> | <span class="keyword">export</span> <span class="keyword">default</span> <span class="comment">// 导出</span></span><br><span class="line"><span class="keyword">import</span> ... <span class="keyword">from</span> <span class="string">&#x27;xxx&#x27;</span>   <span class="comment">// 导入</span></span><br></pre></td></tr></table></figure>

<h4 id="cmd-amd-commonjs-es6-module有什么区别"><a href="#cmd-amd-commonjs-es6-module有什么区别" class="headerlink" title="cmd, amd, commonjs, es6 module有什么区别"></a><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903983987834888">cmd, amd, commonjs, es6 module有什么区别</a></h4><p>AMD一开始是CommonJS规范中的一个草案, 由requirejs实现，所以amd一般指requirejs<br>commonjs属于服务端模块化机制，nodejs，webpack都是基于该规范来实现。<br>es6 Module是es6中规定的模块体系，有望成为浏览器和服务器通用的模块解决方案</p>
<h4 id="es6-module对比commonjs区别"><a href="#es6-module对比commonjs区别" class="headerlink" title="es6 module对比commonjs区别"></a>es6 module对比commonjs区别</h4><ol>
<li>CommonJS模块是运行时加载，ES6 Module是编译时输出接口；</li>
<li>CommonJS加载的是整个模块，将所有的接口全部加载进来，ES6 Module可以单独加载其中的某个接口；</li>
<li>CommonJS输出是值的拷贝，ES6 Module输出的是值的引用，被输出模块的内部的改变会影响引用的改变；</li>
<li>CommonJS this指向当前模块，ES6 Module this指向undefined;</li>
</ol>
<p>前面说的是js的模块化，下面说说css模块化</p>
<h4 id="css模块化"><a href="#css模块化" class="headerlink" title="css模块化"></a>css模块化</h4><p>OOCSS（面向对象CSS） &#x2F;&#x2F; 适用于大项目</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">----------<span class="attr">--index</span><span class="selector-class">.css-----------</span></span><br><span class="line">  w100 &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  h100 &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">----------<span class="attr">--index</span><span class="selector-class">.html----------------</span></span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;w100 h100&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="vue-scoped-style-scoped实现原理"><a href="#vue-scoped-style-scoped实现原理" class="headerlink" title="vue scoped&#x2F;style scoped实现原理"></a>vue scoped&#x2F;style scoped实现原理</h4><p>AMCSS(属性模块) 属性选择器，避免使用过多的class</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-------------<span class="attr">--index</span><span class="selector-class">.css--------------</span></span><br><span class="line">  <span class="selector-attr">[auto-test=<span class="string">&quot;abc&quot;</span>]</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: yellowgreen;</span><br><span class="line">  &#125;</span><br><span class="line">---------------<span class="attr">--index</span><span class="selector-class">.vue---------------</span></span><br><span class="line">  &lt;<span class="selector-tag">div</span> auto-test=&quot;abc&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br></pre></td></tr></table></figure>
<h2 id="webpack-4-x"><a href="#webpack-4-x" class="headerlink" title="webpack 4.x"></a>webpack 4.x</h2><h3 id="webpack-常用命令"><a href="#webpack-常用命令" class="headerlink" title="webpack 常用命令"></a>webpack 常用命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall webpack -g  // 卸载全局webpack</span><br><span class="line">npm install webpack -g    // 安装全局webpack</span><br><span class="line">webpack --version  // 查看webpack版本</span><br><span class="line">npm info webpack // webpack版本list</span><br></pre></td></tr></table></figure>
<h3 id="webpack初始化项目"><a href="#webpack初始化项目" class="headerlink" title="webpack初始化项目"></a>webpack初始化项目</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<h3 id="webpack多入口打包"><a href="#webpack多入口打包" class="headerlink" title="webpack多入口打包"></a>webpack多入口打包</h3><p><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/multi-entry">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack app.<span class="property">js</span> main.<span class="property">js</span> -o bundle.<span class="property">js</span> --mode <span class="string">&quot;development&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="webpack基本配置"><a href="#webpack基本配置" class="headerlink" title="webpack基本配置"></a>webpack基本配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/app.js&quot;</span>,  <span class="comment">// 入口</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,   <span class="comment">// 模式</span></span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;  <span class="comment">// dev服务</span></span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;8000&quot;</span>,</span><br><span class="line">    <span class="attr">proxy</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;xxx&quot;</span>,   <span class="comment">// 输出路径</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name]-[hash:5].js&quot;</span> <span class="comment">// 文件名</span></span><br><span class="line">    <span class="attr">library</span>: <span class="string">&quot;[name]&quot;</span>  <span class="comment">// 通过全局变量暴露出去</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123; <span class="comment">// 别名</span></span><br><span class="line">      <span class="string">&quot;@/&quot;</span>: <span class="string">&quot;xxx&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">extension</span>: [<span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.css&quot;</span>]  <span class="comment">// 文件名扩展</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [ <span class="comment">// 加载loader list</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;xxx&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [ <span class="comment">// 插件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Htmlwebpackplugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;index.html&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;  <span class="comment">// 打包优化</span></span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ES6-转es5语法"><a href="#ES6-转es5语法" class="headerlink" title="ES6+转es5语法"></a>ES6+转es5语法</h3><h4 id="1-全局垫片"><a href="#1-全局垫片" class="headerlink" title="(1) 全局垫片"></a>(1) 全局垫片</h4><ul>
<li><p>下载babel<br><code>npm i babel-loader @babel/core @babel/preset-env --save-dev</code><br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/es6Toes5">demo</a><br>webpack打包后只能将我们es6+的语法转成ES5的语法，但是ES6的一些内置API和功能（Promise Set Map）Object.assign() 如果我们要实现这些这些，我们需要使用 垫片库（polyfill） </p>
</li>
<li><p>后台系统可以考虑不用babel-loader</p>
<!-- <img src="../.vuepress/public/images/115.png" width="600px" > -->
<p><img src="/2022/03/12/2022-03-12-webpack/115.png" alt="图片"></p>
</li>
</ul>
<p><code>npm install -D @babel/polyfill</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">--------------------app.<span class="property">js</span>--------------------------</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;@babel/polyfill&quot;</span>;  <span class="comment">// 全局垫片</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> c = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">const</span> result = [<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">()=&gt;</span>&#123;&#125;), <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">()=&gt;</span>&#123;&#125;)];  <span class="comment">// IE不支持Promise</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, c);</span><br><span class="line">result.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------webpack.<span class="property">config</span>.<span class="property">js</span>---------</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,  <span class="comment">// 默认es6语法转es5, 部分api(promise)需要配置babelrc</span></span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="IE运行情况如下-未加垫片"><a href="#IE运行情况如下-未加垫片" class="headerlink" title="IE运行情况如下(未加垫片)"></a>IE运行情况如下(未加垫片)</h5><!-- <img src="../.vuepress/public/images/116.png"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/116.png" alt="图片"></p>
<!-- <img src="../.vuepress/public/images/117.png"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/117.png" alt="图片"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-----------------babelrc------------------------</span><br><span class="line"><span class="comment">//全局垫片配置如下  ps: 全局垫片是在修改原型，所以不安全。</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;presets&quot;</span>:[[<span class="string">&quot;@babel/preset-env&quot;</span>,&#123;</span><br><span class="line">		<span class="string">&quot;useBuiltIns&quot;</span>:<span class="string">&quot;usage&quot;</span>,  <span class="comment">// 不需要入口文件import @babel/polyfill</span></span><br><span class="line">		<span class="string">&quot;targets&quot;</span>:&#123;  <span class="comment">// 兼容目标</span></span><br><span class="line">			 <span class="comment">// chrome:&quot;67&quot;</span></span><br><span class="line">			 <span class="string">&quot;ie&quot;</span>:<span class="string">&quot;9&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ps: 开发库或者框架的话请使用局部垫片</code></p>
<h4 id="2-局部垫片"><a href="#2-局部垫片" class="headerlink" title="(2) 局部垫片"></a>(2) 局部垫片</h4><ul>
<li>安装<br><code>npm install --save-dev @babel/plugin-transform-runtime @babel/runtime</code><br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/es6Toes5">demo</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-------------------babelrc-------------------------</span><br><span class="line"><span class="comment">// 局部垫片</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;presets&quot;</span>:[<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">	<span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;absoluteRuntime&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;corejs&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;helpers&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;regenerator&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;useESModules&quot;</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ] </span><br><span class="line">&#125;</span><br><span class="line">报错： <span class="string">`Module not found: Error: Can&#x27;t resolve &#x27;@babel/runtime-corejs2/core-js/promise&#x27; in &#x27;c:\Users\Gao\Desktop\code&#x27;`</span></span><br><span class="line"></span><br><span class="line">需要下载一个包：<span class="string">`npm install --save @babel/runtime-corejs2`</span></span><br></pre></td></tr></table></figure>

<h4 id="全局垫片和局部垫片的区别"><a href="#全局垫片和局部垫片的区别" class="headerlink" title="全局垫片和局部垫片的区别"></a>全局垫片和局部垫片的区别</h4><!-- <img src="../.vuepress/public/images/118.png" width="600px" > -->
<p><img src="/2022/03/12/2022-03-12-webpack/118.png" alt="图片"></p>
<h3 id="支持ts"><a href="#支持ts" class="headerlink" title="支持ts"></a>支持ts</h3><p><code>npm install --save-dev typescript ts-loader</code><br><code>npm install @types/lodash</code> &#x2F;&#x2F; 安装类型约束<br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/typescript">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">------------------demo.<span class="property">js</span>------------</span><br><span class="line">interface <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="title class_">String</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPerson</span>(<span class="params">person: Person</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getPerson</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;alan&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="string">&quot;20&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123</span>);</span><br><span class="line"></span><br><span class="line">----------------webpack.<span class="property">config</span>.<span class="property">js</span>-------------</span><br><span class="line"><span class="comment">// ts-loader配置，也可以配置tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">  <span class="attr">loader</span>:<span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">transpileOnly</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">compilerOptions</span>: &#123;</span><br><span class="line">      <span class="attr">module</span>: <span class="string">&quot;es6&quot;</span>,</span><br><span class="line">      <span class="attr">target</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">      <span class="attr">jsx</span>: <span class="string">&quot;react&quot;</span>,</span><br><span class="line">      <span class="attr">allowJs</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">include</span>: [</span><br><span class="line">      <span class="string">&quot;./src/&quot;</span>,</span><br><span class="line">      <span class="string">&quot;./&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">exclude</span>: [</span><br><span class="line">      <span class="string">&quot;node_modules&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------------tsconfig.<span class="property">json</span>--------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">transpileOnly</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">compilerOptions</span>: &#123;</span><br><span class="line">    <span class="attr">module</span>: <span class="string">&quot;es6&quot;</span>,</span><br><span class="line">    <span class="attr">target</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">    <span class="attr">jsx</span>: <span class="string">&quot;react&quot;</span>,</span><br><span class="line">    <span class="attr">allowJs</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">   <span class="attr">include</span>: [</span><br><span class="line">      <span class="string">&quot;./src/&quot;</span>,</span><br><span class="line">      <span class="string">&quot;./&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">exclude</span>: [</span><br><span class="line">      <span class="string">&quot;node_modules&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="ts类型约束"><a href="#ts类型约束" class="headerlink" title="ts类型约束"></a>ts类型约束</h4><p><code>http://microsoft.github.io/TypeSearch/</code></p>
<h4 id="打包图片"><a href="#打包图片" class="headerlink" title="打包图片"></a>打包图片</h4><p><code>npm install file-loader --save-dev</code><br><code>npm install url-loader --save-dev</code>  &#x2F;&#x2F; url-loader内置了file-loader,可以把图片写成base64格式<br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/images">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---------------webpack.<span class="property">config</span>.<span class="property">js</span>---------------</span><br><span class="line">	&#123;</span><br><span class="line">    <span class="attr">test</span>:<span class="regexp">/\.(png|jpe?g|gif)$/</span>,</span><br><span class="line">    <span class="attr">use</span>:&#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="打包css"><a href="#打包css" class="headerlink" title="打包css"></a>打包css</h4><p><code>npm install --save-dev css-loader style-loader</code><br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/css">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-----------webpack.<span class="property">config</span>.<span class="property">js</span>------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,  </span><br><span class="line">  <span class="attr">use</span>: [</span><br><span class="line">    <span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>  <span class="comment">// loader加载从右到左</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="打包css预编译处理语言-scss-less-stylus"><a href="#打包css预编译处理语言-scss-less-stylus" class="headerlink" title="打包css预编译处理语言(scss, less, stylus)"></a>打包css预编译处理语言(scss, less, stylus)</h4><p><code>npm install sass-loader node-sass --save-dev</code><br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/sass">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--------------webpack.<span class="property">config</span>.<span class="property">js</span>--------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">  <span class="attr">use</span>: [</span><br><span class="line">    <span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="添加css3前缀"><a href="#添加css3前缀" class="headerlink" title="添加css3前缀"></a>添加css3前缀</h4><p><code>npm install -D postcss-loader autoprefixer</code><br><a target="_blank" rel="noopener" href="https://github.com/alan89757/autoprefixer">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-------------------package.<span class="property">json</span>-----------------</span><br><span class="line"><span class="comment">// ps：注意包版本</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;clean-webpack-plugin&quot;</span>: <span class="string">&quot;^4.0.0-alpha.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;html-webpack-plugin&quot;</span>: <span class="string">&quot;^4.3.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;autoprefixer&quot;</span>: <span class="string">&quot;8.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;css-loader&quot;</span>: <span class="string">&quot;2.1.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;postcss-loader&quot;</span>: <span class="string">&quot;3.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;style-loader&quot;</span>: <span class="string">&quot;1.2.1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;webpack&quot;</span>: <span class="string">&quot;4.43.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;webpack-cli&quot;</span>: <span class="string">&quot;3.3.11&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------webpack.<span class="property">config</span>.<span class="property">js</span>-------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">  <span class="attr">use</span>: [</span><br><span class="line">    <span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loade&quot;</span>, <span class="string">&quot;postcss-loader&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="css模块化打包"><a href="#css模块化打包" class="headerlink" title="css模块化打包"></a>css模块化打包</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">-------------------app.<span class="property">js</span>-----------------------</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Apple</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./fruits.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./app.scss&quot;</span></span><br><span class="line"><span class="keyword">import</span> apple <span class="keyword">from</span> <span class="string">&quot;./apple.png&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Apple</span>();  <span class="comment">// 画一个苹果</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">img.<span class="property">src</span> = apple;</span><br><span class="line"><span class="comment">// img.classList.add(&quot;apple&quot;);  // 普通写法</span></span><br><span class="line">img.<span class="property">classList</span>.<span class="title function_">add</span>(styles.<span class="property">apple</span>); <span class="comment">// css模块化写法</span></span><br><span class="line"><span class="keyword">var</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">dom.<span class="title function_">appendChild</span>(img);</span><br><span class="line"></span><br><span class="line">--------------  fruits.<span class="property">js</span>-----------------</span><br><span class="line"><span class="keyword">import</span> apple <span class="keyword">from</span> <span class="string">&quot;./apple.png&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Apple</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">  img.<span class="property">src</span> = apple;</span><br><span class="line">  img.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">  dom.<span class="title function_">appendChild</span>(img);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="title class_">Apple</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">------------------webpack.<span class="property">config</span>.<span class="property">js</span>------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">  <span class="attr">use</span>: [</span><br><span class="line">    <span class="string">&quot;style-loader&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">loader</span>:  <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">modules</span>: <span class="literal">true</span>  <span class="comment">// css模块化</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;sass-loader&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/cssModule">demo源码</a></p>
<h4 id="配置支持font"><a href="#配置支持font" class="headerlink" title="配置支持font"></a>配置支持font</h4><p><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/font">demo源码</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">---------------webpack.<span class="property">config</span>.<span class="property">js</span>--------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [</span><br><span class="line">        <span class="string">&quot;style-loader&quot;</span>, &#123;</span><br><span class="line">          <span class="attr">loader</span>:  <span class="string">&quot;css-loader&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(woff|woff2|svg|eot|ttf)$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;file-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">outputPath</span>: <span class="string">&quot;font/&quot;</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;[name]-[contentHash:5].[ext]&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Plugins使用（常用）"><a href="#Plugins使用（常用）" class="headerlink" title="Plugins使用（常用）"></a>Plugins使用（常用）</h4><p><code>npm install  -D html-webpack-plugin</code>  &#x2F;&#x2F; 模板配置<br><code>npm install  -D clean-webpack-plugin</code>  &#x2F;&#x2F; 清除dist&#x2F;数据 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--------------webpack.<span class="property">config</span>.<span class="property">js</span>------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="模板中注入静态文件"><a href="#模板中注入静态文件" class="headerlink" title="模板中注入静态文件"></a>模板中注入静态文件</h4><p><code>npm i add-asset-html-webpack-plugin</code><br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/envVar">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">--------------webpack.<span class="property">config</span>.<span class="property">js</span>----------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filepath</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./dll/vendors.dll.js&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="静态资源同步到CDN"><a href="#静态资源同步到CDN" class="headerlink" title="静态资源同步到CDN"></a>静态资源同步到CDN</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">------------------webpack.<span class="property">config</span>.<span class="property">js</span>---------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;https://aidianzan.com/&quot;</span>   <span class="comment">// index.html会引入https://static.cdn.com/下的资源</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如下图：</p>
<!-- <img src="../.vuepress/public/images/119.png" width="600px"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/119.png" alt="图片"></p>
<h4 id="sourceMap-的配置（快速定位到源码所在位置）"><a href="#sourceMap-的配置（快速定位到源码所在位置）" class="headerlink" title="sourceMap 的配置（快速定位到源码所在位置）"></a>sourceMap 的配置（快速定位到源码所在位置）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">------------------webpack.<span class="property">config</span>.<span class="property">js</span>---------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;cheap-module-source-map&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="开启本地服务webpackDevServer"><a href="#开启本地服务webpackDevServer" class="headerlink" title="开启本地服务webpackDevServer"></a>开启本地服务webpackDevServer</h4><ol>
<li><code>webpack --watch</code>  &#x2F;&#x2F; 需要手动刷新浏览器 </li>
<li><code>webpack-dev-server</code>  &#x2F;&#x2F; 自动刷新<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">-----------package.<span class="property">json</span>---------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;webpack-dev-server --config ./build/webpack.config.js&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">------------------webpack.<span class="property">config</span>.<span class="property">js</span>---------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">contentBase</span>: <span class="string">&quot;./dist&quot;</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9091</span>,</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,  <span class="comment">// 开启热模块更新,同时配置插件webpack.HotModuleReplacementPlugin</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123;   <span class="comment">// 反向代理</span></span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://localhost:9090&quot;</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>()  <span class="comment">// hot: true</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="HMR-热模块更新"><a href="#HMR-热模块更新" class="headerlink" title="HMR(热模块更新)"></a>HMR(热模块更新)</h3><p><a href="%5Bdemo%5D(https://github.com/alan89757/webpack-analysis/tree/master/src/hmr)">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">------------------main.<span class="property">js</span>-----------------</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./app.css&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>)</span><br><span class="line">btn.<span class="property">innerHTML</span> = <span class="string">&quot;新增按钮&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(btn)</span><br><span class="line"></span><br><span class="line">btn.<span class="property">onclick</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">	div.<span class="property">innerHTML</span>=<span class="string">&quot;hahaha&quot;</span>;</span><br><span class="line">	<span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">------------app.<span class="property">css</span>-------------</span><br><span class="line"><span class="attr">div</span>:nth-<span class="keyword">of</span>-<span class="title function_">type</span>(<span class="params">odd</span>)&#123;</span><br><span class="line">	<span class="attr">background</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="treeShaking"><a href="#treeShaking" class="headerlink" title="treeShaking"></a>treeShaking</h4><p>只有es module支持treeShaking(因为只有esModule支持单独加载模块的某个接口), 只有生产模式能做treeShaking(开发模式不支持)，配置mode&#x3D;production就可以了<br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/treeshaking">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-----------------package.<span class="property">json</span>------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;slideEffects&quot;</span>: [  <span class="comment">// 过滤不需要treeshaking的文件</span></span><br><span class="line">    <span class="string">&quot;@babel/polyfill&quot;</span>,</span><br><span class="line">    <span class="string">&quot;*.css&quot;</span></span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------------webpack.<span class="property">config</span>.<span class="property">js</span>-------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">usedExports</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="development-和-production"><a href="#development-和-production" class="headerlink" title="development 和 production"></a>development 和 production</h4><p>提取一个公共的配置文件webpack.common.js</p>
<p><code>npm i webpack-merge</code>  &#x2F;&#x2F; 类似Object.assign<br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/envVar">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">-------------webpack.<span class="property">dev</span>.<span class="property">js</span>--------------</span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack-merge&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> commonConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpack.common.js&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> devConfig = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9090</span>,</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>     <span class="comment">// 开启热模块更新</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(commonConfig, devConfig);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------webpack.<span class="property">prod</span>.<span class="property">js</span>-----------------</span><br><span class="line"><span class="keyword">const</span> commonConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpack.common&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">default</span>: merge &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack-merge&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> prodConfig = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(commonConfig, prodConfig);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------webpack.<span class="property">common</span>.<span class="property">js</span>-----------------</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">main</span>: <span class="string">&quot;./src/envVar/main.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].js&quot;</span>, </span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="两种引入第三方库的方式"><a href="#两种引入第三方库的方式" class="headerlink" title="两种引入第三方库的方式"></a>两种引入第三方库的方式</h4><h5 id="通过expose-loader-进行全局变量注入"><a href="#通过expose-loader-进行全局变量注入" class="headerlink" title="通过expose-loader 进行全局变量注入"></a>通过expose-loader 进行全局变量注入</h5><p><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/expose-loader">demo</a><br><code>npm i -D expose-loader@0.7.5</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">----------webpack.<span class="property">config</span>.<span class="property">js</span>-------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 这里是require，不是path</span></span><br><span class="line">  <span class="attr">test</span>: <span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&quot;jquery&quot;</span>),  <span class="comment">// 获取jquery绝对路径，loader只会作用与jquery</span></span><br><span class="line">  <span class="attr">use</span>: &#123;</span><br><span class="line">    <span class="attr">loader</span>: <span class="string">&quot;expose-loader&quot;</span>,</span><br><span class="line">    <span class="attr">options</span>: <span class="string">&quot;$&quot;</span>    <span class="comment">// 挂载到全局变量了</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">---------------main.<span class="property">js</span>-----------------</span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&quot;jquery&quot;</span>;</span><br><span class="line">$(<span class="string">&quot;body&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;backgroundColor&quot;</span>, <span class="string">&quot;yellowgreen&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>($);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">$</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<!-- <img src="../.vuepress/public/images/120.png" width="600px"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/120.png" alt="图片"></p>
<h5 id="通过内置插件，webpack-ProvidePlugin对每个模块的的空间注入一个变量，然后去自动加载模块，就不用在每个文件内去引入import-或者require"><a href="#通过内置插件，webpack-ProvidePlugin对每个模块的的空间注入一个变量，然后去自动加载模块，就不用在每个文件内去引入import-或者require" class="headerlink" title="通过内置插件，webpack.ProvidePlugin对每个模块的的空间注入一个变量，然后去自动加载模块，就不用在每个文件内去引入import 或者require"></a>通过内置插件，webpack.ProvidePlugin对每个模块的的空间注入一个变量，然后去自动加载模块，就不用在每个文件内去引入import 或者require</h5><p> <a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/provide-plugin">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">---------------webpack.<span class="property">config</span>.<span class="property">js</span>----------------</span><br><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">ProvidePlugin</span>(&#123;  <span class="comment">// 每个模块空间注入一个jquery</span></span><br><span class="line">  <span class="attr">$</span>: <span class="string">&quot;jquery&quot;</span>,</span><br><span class="line">  <span class="attr">jQuery</span>: <span class="string">&quot;jquery&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">--------------main.<span class="property">js</span>------------</span><br><span class="line"><span class="comment">// import $ from &quot;jquery&quot;; // 不需要手动引入</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;body&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;backgroundColor&quot;</span>, <span class="string">&quot;yellowgreen&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>($);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="externals"><a href="#externals" class="headerlink" title="externals"></a>externals</h5><p>在html文件中引入cdn文件，在webpack配置externals，这样就不会打包引入的cdn的库<br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/externals">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">--------------------index.<span class="property">html</span>-----------------------</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>externals<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">script</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">src</span>=<span class="string">&quot;https://code.jquery.com/jquery-3.1.0.js&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">integrity</span>=<span class="string">&quot;sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk=&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">---------------------webpack.<span class="property">config</span>.<span class="property">js</span>-------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">externals</span>: &#123;</span><br><span class="line">    <span class="attr">jquery</span>: <span class="string">&#x27;jQuery&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<!-- <img src="../.vuepress/public/images/121.png" width="600px"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/121.png" alt="图片"></p>
<!-- <img src="../.vuepress/public/images/122.png" width="600px"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/122.png" alt="图片"></p>
<h4 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h4><p>跨域的解决方式：</p>
<ul>
<li>jsonp &#x2F;&#x2F; 只支持get，比较少用<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-----------------index.html--------------</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>JSONP 实例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;divCustomers&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">callbackFn</span>(<span class="params">result, methodName</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span></span><br><span class="line"><span class="language-javascript">    result = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(result);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> html = <span class="string">&#x27;&lt;ul&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; result.<span class="property">length</span>; i++)</span></span><br><span class="line"><span class="language-javascript">    &#123;</span></span><br><span class="line"><span class="language-javascript">        html += <span class="string">&#x27;&lt;li&gt;&#x27;</span> + result[i] + <span class="string">&#x27;&lt;/li&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    html += <span class="string">&#x27;&lt;/ul&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;divCustomers&#x27;</span>).<span class="property">innerHTML</span> = html;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:3000?jsoncallback=callbackFn&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">---------------server.<span class="property">js</span>-----------------</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;*&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="string">&#x27;[&quot;苹果&quot;,&quot;香蕉&quot;,&quot;凤梨&quot;,&quot;火龙果&quot;]&#x27;</span>;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;callbackFn(&#x27;&quot;</span> + data + <span class="string">&quot;&#x27;)&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务启动中...&quot;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>cors   &#x2F;&#x2F; 服务器配置<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-----------------index.html-----------------</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>cors<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    axios.<span class="title function_">get</span>(<span class="string">&quot;http://localhost:3000/getJSON&quot;</span>).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>).<span class="property">innerHTML</span> = response.<span class="property">data</span>.<span class="property">hello</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-----------------server.<span class="property">js</span>----------------------</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>());</span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;*&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/getJSON&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">hello</span>: <span class="string">&quot;world&quot;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务启动中...&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>proxy代理  &#x2F;&#x2F; webpack支持配置</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-------------------webpack.<span class="property">config</span>.<span class="property">js</span>----------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">proxy</span>: &#123;   <span class="comment">// 反向代理</span></span><br><span class="line">    <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">target</span>: <span class="string">&quot;http://localhost:9090&quot;</span>,</span><br><span class="line">      <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">        <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代码分割（代码分割和webpack无关，用来提升性能）"><a href="#代码分割（代码分割和webpack无关，用来提升性能）" class="headerlink" title="代码分割（代码分割和webpack无关，用来提升性能）"></a>代码分割（代码分割和webpack无关，用来提升性能）</h2><ul>
<li>入口起点(多入口)：使用entry配置手动的分离代码<br>  将不同的文件内引入的相同的库会分别打包到不同的文件中(使用很少)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">----------webpack.<span class="property">config</span>.<span class="property">js</span>---------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">main</span>: <span class="string">&quot;./src/entry/main.js&quot;</span>,</span><br><span class="line">    <span class="attr">app</span>: <span class="string">&quot;./src/entry/app.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>防止重复：使用SplitChunksPlugin去重和分离chunk, webpack4.x以前用CommonChunkPlugin</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">------------------webpack.<span class="property">config</span>.<span class="property">js</span>-----------------</span><br><span class="line"><span class="comment">// splitChunks详细配置</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>, <span class="comment">// 3个值async initial， all,针对异步，同步，所有代码做分割</span></span><br><span class="line">      <span class="attr">minSize</span>: <span class="number">30000</span>, <span class="comment">// 引入的包或者模块大于30000个字节才会做代码分割,针对于同步加载的模块才有效</span></span><br><span class="line">      <span class="attr">maxSize</span>: <span class="number">0</span>, <span class="comment">// 可配置，也不可配置，当打包的内容超出这个值之后，会尝试二次打包，但是拆分不了的部分，就无法拆分，不太常用</span></span><br><span class="line">      <span class="attr">minChunks</span>: <span class="number">2</span>, <span class="comment">// 引入次数，引入次数为 n 可以打包</span></span><br><span class="line">      <span class="attr">maxAsyncRequests</span>: <span class="number">5</span>, <span class="comment">// 异步加载时同时发送的请求数量不能超过5个，超过5个的部分不才分，一般不去修改</span></span><br><span class="line">      <span class="attr">maxInitialRequests</span>: <span class="number">3</span>,<span class="comment">// 页面初始化时同时发送的请求数量最大不能超过3个，超过的3个部分就不ibei拆分</span></span><br><span class="line">      <span class="attr">automaticNameDelimiter</span>: <span class="string">&#x27;~&#x27;</span>, <span class="comment">//打包出来的文件名的默认连接符</span></span><br><span class="line">      <span class="comment">// automaticNameMaxLength: 30, // 文件名最长不能超过30个字符</span></span><br><span class="line">      <span class="attr">name</span>: <span class="literal">true</span>,  <span class="comment">// 拆分的chunk名，true 表示根据模块名和CacheGroup组的key来自动生成，使用上面的连接符</span></span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123; <span class="comment">// 缓存配置：一个文件内import 多个库，如果需要将多个库打包在一个文件内就要缓存,所以命名为缓存组</span></span><br><span class="line">        <span class="attr">vendors</span>: &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>, <span class="comment">// 监测引入的库是否是node_modules下的，jquery，lodash，</span></span><br><span class="line">          <span class="attr">priority</span>: -<span class="number">10</span> <span class="comment">//权重：决定哪个组优先匹配，比如：node_modules下面有模块要拆分，如果同时后满足vendors ，default组，哪个priority值大，就按照哪个组去打包</span></span><br><span class="line">				&#125;,</span><br><span class="line">        <span class="attr">default</span>: &#123; <span class="comment">// </span></span><br><span class="line">          <span class="attr">minChunks</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">priority</span>: -<span class="number">20</span>,</span><br><span class="line">					<span class="attr">reuseExistingChunk</span>: <span class="literal">true</span> <span class="comment">// 当main.js引入 a.js,b.js, 但是a 中引入了b，就会重复引用，开始这个属性之后，就不会重复打包b.js,会复用</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>动态导入：通过模块的懒加载调用来分离代码<br>webpack4 默认允许import语法动态导入，它是ES7的提交草案，需要babel的插件支持，最新版的babel插件包<code> @babel/plugin-syntax-dynamic-import</code>  <strong>注意：动态导入的最大好处是实现了懒加载</strong>，用到某个模块就加载哪个模块，SPA vue react路由懒加载 原理一样</li>
</ul>
<p><code>npm i -D @babel/plugin-syntax-dynamic-import</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">----------------------app.<span class="property">js</span>---------------------------</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getComponent</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 执行的时候才会引入jquery</span></span><br><span class="line">	<span class="keyword">const</span> &#123;<span class="attr">default</span>: $&#125; = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName:&quot;jquery&quot; */</span> <span class="string">&quot;jquery&quot;</span>);</span><br><span class="line">	$(<span class="string">&quot;body&quot;</span>).<span class="title function_">append</span>( $(<span class="string">&quot;&lt;div&gt;&lt;/div&gt;&quot;</span>).<span class="title function_">html</span>(<span class="string">&quot;main&quot;</span>) )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">	<span class="title function_">getComponent</span>();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">------------------------babelrc----------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;targets&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;browsers&quot;</span>: [<span class="string">&quot;last 2 chrome versions&quot;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;useBuiltIns&quot;</span>: <span class="string">&quot;usage&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="懒加载和动态导入有什么区别"><a href="#懒加载和动态导入有什么区别" class="headerlink" title="懒加载和动态导入有什么区别"></a>懒加载和动态导入有什么区别</h4><p>动态导入的最大好处是实现了懒加载</p>
<h4 id="打包分析"><a href="#打包分析" class="headerlink" title="打包分析"></a>打包分析</h4><ol>
<li><p>脚本加入 –profile –json &gt; stats.json  &#x2F;&#x2F; 注意webpack和webpack-cli版本<br>把生成stats.json放入<a target="_blank" rel="noopener" href="https://webpack.github.io/analyse/">https://webpack.github.io/analyse/</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---------------package.<span class="property">json</span>----------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;analyse-file&quot;</span>: <span class="string">&quot;webpack --profile --json &gt; stats.json --config ./src/analyse-file/webpack.config.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;webpack&quot;</span>: <span class="string">&quot;^4.43.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^3.3.2&quot;</span>,    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<!-- <img src="../.vuepress/public/images/123.png" style="width: 600px;"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/123.png" alt="图片"></p>
</li>
<li><p>插件分析<br><code>npm install --save-dev webpack-bundle-analyzer</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">------------webpack.<span class="property">config</span>.<span class="property">js</span>--------------</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">BundleAnalyzerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;webpack-bundle-analyzer&quot;</span>).<span class="property">BundleAnalyzerPlugin</span>;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">app</span>: <span class="string">&quot;./src/bundle-analyzer/app.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">contentBase</span>: <span class="string">&quot;./dist&quot;</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9090</span>,</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>     <span class="comment">// 开启热模块更新</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">BundleAnalyzerPlugin</span>()  <span class="comment">// 代码分析</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/bundle-analyzer">demo</a></p>
</li>
</ol>
<h4 id="prefetch和preload"><a href="#prefetch和preload" class="headerlink" title="prefetch和preload"></a>prefetch和preload</h4><h5 id="prefetch-预加载"><a href="#prefetch-预加载" class="headerlink" title="prefetch 预加载"></a>prefetch 预加载</h5><p>在网络空闲的时候，一般是首页核心代码加载完成之后，再偷偷加载其他js代码,即预加载。<br>资源的下载顺序权重比较低。也就是说prefetch通常用于加速下一次导航，而不是本次的。被标记为prefetch的资源，将会被浏览器在空闲时间加载。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">--------------main.<span class="property">js</span>------------------</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 预加载</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="comment">/* webpackPrefetch: true */</span> <span class="string">&quot;./app.js&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123;<span class="keyword">default</span>: add&#125;</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">add</span>();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">--------------app.<span class="property">js</span>----------------</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addDiv</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  div.<span class="property">innerHTML</span> = <span class="string">&quot;main&quot;</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> addDiv;</span><br></pre></td></tr></table></figure>

<h5 id="preload-优先加载（较高优先级）"><a href="#preload-优先加载（较高优先级）" class="headerlink" title="preload 优先加载（较高优先级）"></a>preload 优先加载（较高优先级）</h5><p>通常用于本页面要用到的关键资源，包括关键js、字体、css文件。preload将会把资源得下载顺序权重提高，使得关键数据提前下载好，优化页面打开速度。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-------------main.<span class="property">js</span>------------</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addDiv</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  div.<span class="property">innerHTML</span> = <span class="string">&quot;main&quot;</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> addDiv;</span><br><span class="line"></span><br><span class="line">--------------app.<span class="property">js</span>----------------</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">import</span>(<span class="comment">/* webpackPreload: true */</span> <span class="string">&quot;./main.js&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123;<span class="keyword">default</span>: add&#125;</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">add</span>();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>缓存带来的代码提升是有限的，所以懒加载代码优化成为我们性能提升的最重要的方式</code></p>
<h4 id="css文件代码分割"><a href="#css文件代码分割" class="headerlink" title="css文件代码分割"></a>css文件代码分割</h4><p><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/css-split">demo</a></p>
<ol>
<li>安装插件<br><code>npm i -D mini-css-extract-plugin</code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">------------------webpack.<span class="property">config</span>.<span class="property">js</span>---------------</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,  <span class="comment">// 替换掉&quot;style-loader&quot;</span></span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;&#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="css压缩"><a href="#css压缩" class="headerlink" title="css压缩"></a>css压缩</h4><p><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/css-compress">demo</a></p>
<ol>
<li><p>安装插件<br><code>npm i -D optimize-css-assets-webpack-plugin@5.0.1</code></p>
</li>
<li><p>配置webpack</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">----------------webpack.<span class="property">config</span>.<span class="property">js</span>-----------------------</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">OptimizeCSSAssetsPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;optimize-css-assets-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserJSPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);  <span class="comment">// 压缩css会使js压缩无效时使用该插件</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [<span class="keyword">new</span> <span class="title class_">TerserJSPlugin</span>(&#123;&#125;), <span class="keyword">new</span> <span class="title class_">OptimizeCSSAssetsPlugin</span>(&#123;&#125;)],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].[contenthash:5].js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>),</span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&quot;[name]-[contenthash:5].js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="webpack浏览器文件存储"><a href="#webpack浏览器文件存储" class="headerlink" title="webpack浏览器文件存储"></a>webpack浏览器文件存储</h4><p>第三方库单独打包vendor，可以使用缓存</p>
<h4 id="通过环境变量走不同的配置"><a href="#通过环境变量走不同的配置" class="headerlink" title="通过环境变量走不同的配置"></a>通过环境变量走不同的配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">----------------package.<span class="property">json</span>------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">scripts</span>: &#123;</span><br><span class="line">    <span class="attr">dev</span>: <span class="string">&quot;webpack-dev-server --config ./build/webpack.common.js&quot;</span></span><br><span class="line">    <span class="attr">prod</span>: <span class="string">&quot;webpack --env.production --config ./build/webpack.common.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">------------------webpack.<span class="property">common</span>.<span class="property">js</span>-------------</span><br><span class="line"><span class="keyword">const</span> prodConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpack.prod.js&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> devConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpack.dev.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">env</span>)=&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(env &amp;&amp; env.<span class="property">production</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(commonConfig, prodConfig)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(commonConfig, devConfig)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编译vue"><a href="#编译vue" class="headerlink" title="编译vue"></a>编译vue</h4><ol>
<li>安装模块<br><code>npm i -S vue</code><br><code>npm i -D vue-loader vue-template-compiler</code><br>vue-loader只要是15.x版本都需要配置一个插件<br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/vue-cli">demo</a><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">--------------------webpack.<span class="property">config</span>.<span class="property">js</span>-------------------</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">VueLoaderPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;vue-loader/lib/plugin&quot;</span>);</span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;vue-loader&quot;</span>,</span><br><span class="line">      <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></span><br><span class="line">     &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.vue&quot;</span>, <span class="string">&quot;.json&quot;</span>],</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;src&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">VueLoaderPlugin</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filepath</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./dll/vendors.dll.js&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="编译react"><a href="#编译react" class="headerlink" title="编译react"></a>编译react</h4><p><code>npm i @babel/preset-env @babel/preset-react -D</code><br><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/react-cli">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">----------------main.<span class="property">js</span>------------</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>webpack react<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">----------------webpack.<span class="property">config</span>.<span class="property">js</span>-----------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">------------babelrc----------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@babel/preset-react&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="webpack打包速度优化"><a href="#webpack打包速度优化" class="headerlink" title="webpack打包速度优化"></a>webpack打包速度优化</h4><ol>
<li>更新node或者webpack版本</li>
<li>减少loader转换</li>
<li>少使用非官方提供的插件</li>
<li>使用DllPlugin提高打包速度</li>
</ol>
<h4 id="配置多个dll文件"><a href="#配置多个dll文件" class="headerlink" title="配置多个dll文件"></a>配置多个dll文件</h4><p>减少单个dll大小</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------------------webpack.<span class="property">config</span>.<span class="property">js</span>-------------------</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> plugins = [</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">CopyWebpackPlugin</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;lisi&quot;</span>&#125;),</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">			<span class="attr">template</span>:<span class="string">&quot;./index.html&quot;</span></span><br><span class="line">	&#125;),</span><br><span class="line">	<span class="keyword">new</span> webpack.<span class="title class_">ProvidePlugin</span>(&#123;</span><br><span class="line">		<span class="attr">$</span>:<span class="string">&quot;jquery&quot;</span>,</span><br><span class="line">		<span class="attr">jQuery</span>:<span class="string">&quot;jquery&quot;</span></span><br><span class="line">	&#125;),</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">VueLoaderPlugin</span>()</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> files = fs.<span class="title function_">readdirSync</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dll&quot;</span>))</span><br><span class="line"><span class="comment">// console.log(files)</span></span><br><span class="line">files.<span class="title function_">forEach</span>(<span class="function"><span class="params">fileName</span>=&gt;</span>&#123;</span><br><span class="line">	 <span class="keyword">if</span>(<span class="regexp">/.*\.dll\.js/</span>.<span class="title function_">test</span>(fileName))&#123;</span><br><span class="line">		  plugins.<span class="title function_">push</span>(</span><br><span class="line">				<span class="keyword">new</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span>(&#123;  <span class="comment">// 第三方模块文件</span></span><br><span class="line">					<span class="attr">filepath</span>:path.<span class="title function_">resolve</span>(__dirname,<span class="string">&quot;../dll&quot;</span>,fileName)</span><br><span class="line">				&#125;)</span><br><span class="line">			)</span><br><span class="line">	 &#125;</span><br><span class="line">	 <span class="keyword">if</span>(<span class="regexp">/.*\.mainfest\.json/</span>.<span class="title function_">test</span>(fileName))&#123;</span><br><span class="line">		  plugins.<span class="title function_">push</span>(</span><br><span class="line">				<span class="keyword">new</span> webpack.<span class="title class_">DllReferencePlugin</span>(&#123;  <span class="comment">// 映射文件</span></span><br><span class="line">					<span class="attr">manifest</span>:path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dll&quot;</span>, fileName)</span><br><span class="line">				&#125;)</span><br><span class="line">			)</span><br><span class="line">	 &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="多线程打包"><a href="#多线程打包" class="headerlink" title="多线程打包"></a>多线程打包</h4><p><code>npm i thread-loader -D</code>  &#x2F;&#x2F; 多线程耗费性能，慎重</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">----------------webpack.<span class="property">config</span>.<span class="property">js</span>-------------</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">workers</span>: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,  <span class="comment">// 默认es6语法转es5, 部分api(promise)需要配置babelrc</span></span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="图片压缩"><a href="#图片压缩" class="headerlink" title="图片压缩"></a>图片压缩</h4><ul>
<li>有损压缩<br><code>npm install imagemin-gifsicle imagemin-mozjpeg imagemin-pngquant imagemin-svgo --save-dev</code></li>
<li>无损压缩<br><code>npm install imagemin-gifsicle imagemin-jpegtran imagemin-optipng imagemin-svgo --save-de</code></li>
</ul>
<h4 id="npm打包发布自己写的插件"><a href="#npm打包发布自己写的插件" class="headerlink" title="npm打包发布自己写的插件"></a>npm打包发布自己写的插件</h4><ol>
<li><p>npm login</p>
<!-- <img src="../.vuepress/public/images/124.png"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/124.png" alt="图片"></p>
</li>
<li><p>npm publish</p>
<!-- <img src="../.vuepress/public/images/125.png"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/125.png" alt="图片"></p>
</li>
</ol>
<!-- <img src="../.vuepress/public/images/126.png"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/126.png" alt="图片"></p>
<hr>
<p><strong>没有发布成功走下面3,4,5步</strong><br>3. npm config get registry<br>4. npm config set registry&#x3D;<a target="_blank" rel="noopener" href="http://registry.npmjs.org/">http://registry.npmjs.org/</a><br>5. npm publish<br>6. 代码更新，重新publish，需要更新版本号</p>
<!-- <img src="../.vuepress/public/images/127.png"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/127.png" alt="图片"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">-----------------webpack.<span class="property">config</span>.<span class="property">js</span>--------------</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">main</span>: <span class="string">&quot;./src/main.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;library.js&quot;</span>,</span><br><span class="line">    <span class="attr">library</span>: <span class="string">&quot;library&quot;</span>,</span><br><span class="line">    <span class="attr">libraryTarget</span>: <span class="string">&quot;umd&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------------main.<span class="property">js</span>-----------------</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> calc <span class="keyword">from</span> <span class="string">&quot;./calc.js&quot;</span>;  <span class="comment">// 计算</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> methods <span class="keyword">from</span> <span class="string">&quot;./methods.js&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  calc, methods</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------------calc.<span class="property">js</span>-----------------</span><br><span class="line"><span class="comment">// 加</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 减</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">minus</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 乘</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">multi</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 除</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">division</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------------methods.<span class="property">js</span>-----------------</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">concat</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + <span class="string">&quot;-&quot;</span> + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">---------------package.<span class="property">json</span>-----------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;assets-router-plugin&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,  <span class="comment">// 每次发布都需要修改版本</span></span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;通过路由配置，支持动态加载js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;./dist/libraray.js&quot;</span>,  <span class="comment">// 入口文件,对应output.filename</span></span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;webpack&quot;</span>: <span class="string">&quot;^4.43.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^3.3.2&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;alan89757&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>测试自己发布的库<code>assets-router-plugin</code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">------------------app.<span class="property">js</span>---------------</span><br><span class="line"><span class="keyword">import</span> result <span class="keyword">from</span> <span class="string">&quot;assets-router-plugin&quot;</span>;  <span class="comment">// es6的import引入</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">calc</span>.<span class="title function_">add</span>(<span class="number">1</span>,<span class="number">5</span>));  <span class="comment">// 6  亲测成功亲测成功</span></span><br><span class="line"></span><br><span class="line">------------------main.<span class="property">js</span>---------------</span><br><span class="line"><span class="keyword">const</span> assetsrouter = <span class="built_in">require</span>(<span class="string">&quot;assets-router-plugin&quot;</span>); <span class="comment">// commonjs引入自己发布的库</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(assetsrouter.<span class="property">default</span>.<span class="property">calc</span>.<span class="title function_">add</span>(<span class="number">1</span>,<span class="number">7</span>))   <span class="comment">// 8 亲测成功</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/use-myplugin">demo</a></li>
</ul>
<h4 id="编写webpack-loader"><a href="#编写webpack-loader" class="headerlink" title="编写webpack loader"></a>编写webpack loader</h4><p><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/use-myloader">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">------------webpack.<span class="property">config</span>.<span class="property">js</span>---------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">main</span>: <span class="string">&quot;./src/main.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../my-loader/loader.js&quot;</span>), <span class="comment">// 加载自定义的loader</span></span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;alan&quot;</span>,</span><br><span class="line">            <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,  </span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------------main.<span class="property">js</span>-----------------------</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello world&quot;</span>); </span><br><span class="line"></span><br><span class="line">-----------------loader.<span class="property">js</span>--------------------</span><br><span class="line"><span class="comment">// 自定义loader</span></span><br><span class="line"><span class="comment">//loader支持的api  https://v4.webpack.js.org/api/loaders/   </span></span><br><span class="line"><span class="comment">// 同步loader</span></span><br><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">&quot;loader-utils&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">source</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> options =loaderUtils.<span class="title function_">getOptions</span>(<span class="variable language_">this</span>);  <span class="comment">// 获取options参数</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(options);</span><br><span class="line">  <span class="keyword">return</span> source.<span class="title function_">replace</span>(<span class="string">&quot;world&quot;</span>, <span class="string">&quot;alan&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------------loaderAsync.<span class="property">js</span>--------------------</span><br><span class="line"><span class="comment">// 异步loader</span></span><br><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">&quot;loader-utils&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">source</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> options =loaderUtils.<span class="title function_">getOptions</span>(<span class="variable language_">this</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(options);</span><br><span class="line">  <span class="keyword">const</span> callback = <span class="variable language_">this</span>.<span class="title function_">async</span>();  <span class="comment">// 异步回调</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="literal">null</span>, source.<span class="title function_">replace</span>(<span class="string">&quot;world&quot;</span>, <span class="string">&quot;alan&quot;</span>));</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader直接配置字符串，需要配置resolveLoader.modules支持loader查找</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">main</span>: <span class="string">&quot;./src/main.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="attr">resolveLoader</span>: &#123;</span><br><span class="line">    <span class="attr">modules</span>: [<span class="string">&quot;node_modules&quot;</span>, path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../my-loader&quot;</span>)]</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [</span><br><span class="line">        <span class="string">&quot;loaderAsync&quot;</span>, <span class="comment">// 需要配置resolveLoader.modules</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写webpack-plugin"><a href="#编写webpack-plugin" class="headerlink" title="编写webpack plugin"></a>编写webpack plugin</h4><p><a target="_blank" rel="noopener" href="https://github.com/alan89757/webpack-analysis/tree/master/src/use-myplugin">demo</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-------------webpack.<span class="property">config</span>.<span class="property">js</span>-----------------</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CopyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;../my-plugin/copy-webpack-plugin&quot;</span>);  <span class="comment">// 自定义的插件</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CopyWebpackPlugin</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------------copy-webpack-plugin.<span class="property">js</span>----------------</span><br><span class="line"><span class="comment">// 自定义webpack插件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CopyWebpackPlugin</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(options)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123; <span class="comment">// compiler是webpack运行实例</span></span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">tapAsync</span>(<span class="string">&quot;CopyWebpackPlugin&quot;</span>, <span class="keyword">function</span>(<span class="params">compilation, cb</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello world_____&quot;</span>)</span><br><span class="line">      compilation.<span class="property">assets</span>[<span class="string">&quot;copy.txt&quot;</span>] = &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&quot;hello alan&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">size</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">cb</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">compile</span>.<span class="title function_">tap</span>(<span class="string">&quot;CopyWebpackPlugin&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;同步钩子...&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">CopyWebpackPlugin</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>node调试<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">------------------------------package.<span class="property">json</span>----------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">scripts</span>: &#123;</span><br><span class="line">    <span class="string">&quot;debug&quot;</span>: <span class="string">&quot;node --inspect --inspect-brk node_modules/webpack/bin/webpack.js --config ./src/use-myplugin/webpack.config.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="写自己的”webpack”-bundle"><a href="#写自己的”webpack”-bundle" class="headerlink" title="写自己的”webpack” (bundle)"></a>写自己的”webpack” (bundle)</h4><p>bundle-demo项目文件目录如下：<br>├── README.md<br>├── src<br>│   └── index.js<br>│   └── message.js<br>│   └── news.js<br>├── package-lock.json<br>├── package.json<br>├── bundle.config.js</p>
<p>bundle项目文件目录如下：<br>├── README.md<br>├── bin<br>│   └── bundle.js<br>├── package-lock.json<br>├── package.json</p>
<h4 id="实现bundle打包步骤如下"><a href="#实现bundle打包步骤如下" class="headerlink" title="实现bundle打包步骤如下"></a>实现bundle打包步骤如下</h4><ol>
<li><p>新建bundle文件夹</p>
</li>
<li><p>在bin目录下新建bundle.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--------------------bundle.<span class="property">js</span>---------------</span><br><span class="line">#!<span class="regexp">/usr/</span>bin/env node</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;bunlde脚本执行&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>npm init -y, 修改bin目录</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">----------------package.<span class="property">json</span>--------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;bin&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bundle&quot;</span>: <span class="string">&quot;./bin/bundle.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>把包发到npmjs.org，或者npm link(把bundle添加软链接到全局), 效果图如下：</p>
<!-- <img src="../.vuepress/public/images/128.png"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/128.png" alt="图片"></p>
</li>
</ol>
<!-- <img src="../.vuepress/public/images/129.png"> -->
<p><img src="/2022/03/12/2022-03-12-webpack/129.png" alt="图片"></p>
<ol start="5">
<li><p>读取bundle.config.js配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">------------------bundle.<span class="property">js</span>--------------------</span><br><span class="line">  #!<span class="regexp">/usr/</span>bin/env node</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;bunlde脚本执行&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(path.<span class="title function_">resolve</span>(<span class="string">&quot;bundle.config.js&quot;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(config);  <span class="comment">// 读取bundle.config.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Compiler</span> = <span class="built_in">require</span>(<span class="string">&quot;../lib/compiler.js&quot;</span>)</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Compiler</span>(config).<span class="title function_">start</span>();</span><br><span class="line"></span><br><span class="line">----------------bundle.<span class="property">config</span>.<span class="property">js</span>----------------</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;app.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------------------index.<span class="property">js</span>---------------------</span><br><span class="line"><span class="keyword">var</span> message = <span class="built_in">require</span>(<span class="string">&quot;./message.js&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(message.<span class="property">content</span>);</span><br><span class="line"></span><br><span class="line">-----------------------message.<span class="property">js</span>---------------------</span><br><span class="line"><span class="keyword">const</span> news = <span class="built_in">require</span>(<span class="string">&quot;./news.js&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">content</span>: <span class="string">&quot;今天天气 &quot;</span>+ news.<span class="property">content</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------------------news.<span class="property">js</span>---------------------</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">content</span>: <span class="string">&quot;下雪22&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>编译类Compiler</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">-------------------compiler.<span class="property">js</span>--------------------</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">&quot;@babel/parser&quot;</span>);  <span class="comment">// 用来转换抽象语法树AST</span></span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">&quot;@babel/traverse&quot;</span>).<span class="property">default</span>;  <span class="comment">// require替换成__webpack_require__</span></span><br><span class="line"><span class="keyword">const</span> generator = <span class="built_in">require</span>(<span class="string">&quot;@babel/generator&quot;</span>).<span class="property">default</span>;  <span class="comment">// 读取代码内容</span></span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&quot;ejs&quot;</span>);   <span class="comment">// ejs模板</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">config</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">config</span> = config;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">entry</span> = config.<span class="property">entry</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">root</span> = process.<span class="title function_">cwd</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">modules</span> = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 读取代码</span></span><br><span class="line">    <span class="title function_">getSource</span>(<span class="params">filepath</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> fs.<span class="title function_">readFileSync</span>(filepath, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 分析模块代码</span></span><br><span class="line">    <span class="title function_">depAnalyes</span>(<span class="params">modulePath</span>) &#123;</span><br><span class="line">        <span class="comment">//2.  获得入口文件内容</span></span><br><span class="line">        <span class="keyword">let</span> source = <span class="variable language_">this</span>.<span class="title function_">getSource</span>(modulePath);</span><br><span class="line">        <span class="keyword">let</span> dependencies = [];   <span class="comment">// 依赖数组</span></span><br><span class="line">        <span class="comment">// 3. 分析内容引入其他模块，使用@babel/parser转换成抽象语法树AST</span></span><br><span class="line">        <span class="comment">//  查看AST抽象语法树地址：https://astexplorer.net/</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable constant_">AST</span> = parser.<span class="title function_">parse</span>(source, &#123;</span><br><span class="line">            <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 4. 找到代码require替换成__webpack_require__, type=CallExpression有require, @babel/traverse</span></span><br><span class="line">        <span class="title function_">traverse</span>(<span class="variable constant_">AST</span>, &#123;</span><br><span class="line">            <span class="title class_">CallExpression</span>: <span class="keyword">function</span>(<span class="params">p</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(p.<span class="property">node</span>.<span class="property">callee</span>.<span class="property">name</span> === <span class="string">&quot;require&quot;</span>) &#123;</span><br><span class="line">                    p.<span class="property">node</span>.<span class="property">callee</span>.<span class="property">name</span> = <span class="string">&quot;__webpack_require__&quot;</span>;</span><br><span class="line">                    <span class="comment">// 6.更改require中的路径</span></span><br><span class="line">                    <span class="keyword">let</span> val = p.<span class="property">node</span>.<span class="property">arguments</span>[<span class="number">0</span>].<span class="property">value</span>;</span><br><span class="line">                    <span class="keyword">let</span> value = <span class="string">&quot;./&quot;</span> + path.<span class="title function_">join</span>(<span class="string">&quot;./src&quot;</span>, val);</span><br><span class="line">                    p.<span class="property">node</span>.<span class="property">arguments</span>[<span class="number">0</span>].<span class="property">value</span> = value.<span class="title function_">replace</span>(<span class="regexp">/\\+/g</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">                    <span class="comment">// 7. 根据路径去加载路径下的内容，分析文件内容，将这个路径push到一个数组中</span></span><br><span class="line">                    dependencies.<span class="title function_">push</span>(p.<span class="property">node</span>.<span class="property">arguments</span>[<span class="number">0</span>].<span class="property">value</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// console.log(dependencies)</span></span><br><span class="line">        <span class="comment">// 8. 递归所有依赖</span></span><br><span class="line">        dependencies.<span class="title function_">forEach</span>(<span class="function"><span class="params">dep</span>=&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> newPath = path.<span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">root</span>, dep);</span><br><span class="line">            <span class="comment">// console.log(newPath)</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">depAnalyes</span>(newPath);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 9. 希望构建结果&#123;&quot;./src/index.js&quot;: &quot;code...&quot;&#125; </span></span><br><span class="line">        <span class="keyword">let</span> relativePath = path.<span class="title function_">relative</span>(<span class="variable language_">this</span>.<span class="property">root</span>, modulePath);</span><br><span class="line">        relativePath = <span class="string">&quot;./&quot;</span> + relativePath.<span class="title function_">replace</span>(<span class="regexp">/\\+/g</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">modules</span>[relativePath] = <span class="title function_">generator</span>(<span class="variable constant_">AST</span>).<span class="property">code</span>;</span><br><span class="line">        <span class="comment">// console.log(this.modules)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 替换模板文件</span></span><br><span class="line">    <span class="title function_">emitFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> template = <span class="variable language_">this</span>.<span class="title function_">getSource</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;../template/template.ejs&quot;</span>));</span><br><span class="line">        <span class="keyword">let</span> result = ejs.<span class="title function_">render</span>(template, &#123;</span><br><span class="line">            <span class="attr">entry</span>: <span class="variable language_">this</span>.<span class="property">entry</span>,</span><br><span class="line">            <span class="attr">modules</span>: <span class="variable language_">this</span>.<span class="property">modules</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> outputPath = path.<span class="title function_">join</span>(<span class="variable language_">this</span>.<span class="property">config</span>.<span class="property">output</span>.<span class="property">path</span>, <span class="variable language_">this</span>.<span class="property">config</span>.<span class="property">output</span>.<span class="property">filename</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// console.log(outputPath);</span></span><br><span class="line">        <span class="comment">// console.log(result);</span></span><br><span class="line">        <span class="comment">// 写入文件</span></span><br><span class="line">        fs.<span class="title function_">writeFileSync</span>(outputPath, result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 编译入口</span></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(this.root, this.entry)</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">depAnalyes</span>(path.<span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">root</span>, <span class="variable language_">this</span>.<span class="property">entry</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">emitFile</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> =  <span class="title class_">Compiler</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模板文件</span></span><br><span class="line">---------------------template.<span class="property">ejs</span>-----------------------</span><br><span class="line"> (<span class="keyword">function</span>(<span class="params">modules</span>) &#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"> 	<span class="comment">// The module cache</span></span><br><span class="line"> 	<span class="keyword">var</span> installedModules = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"> 	<span class="comment">// The require function</span></span><br><span class="line"> 	<span class="keyword">function</span> <span class="title function_">__webpack_require__</span>(<span class="params">moduleId</span>) &#123;</span><br><span class="line"></span><br><span class="line"> 		<span class="comment">// Check if module is in cache</span></span><br><span class="line"> 		<span class="keyword">if</span>(installedModules[moduleId]) &#123;</span><br><span class="line"> 			<span class="keyword">return</span> installedModules[moduleId].<span class="property">exports</span>;</span><br><span class="line"> 		&#125;</span><br><span class="line"> 		<span class="comment">// Create a new module (and put it into the cache)</span></span><br><span class="line"> 		<span class="keyword">var</span> <span class="variable language_">module</span> = installedModules[moduleId] = &#123;</span><br><span class="line"> 			<span class="attr">i</span>: moduleId,</span><br><span class="line"> 			<span class="attr">l</span>: <span class="literal">false</span>,</span><br><span class="line"> 			<span class="attr">exports</span>: &#123;&#125;</span><br><span class="line"> 		&#125;;</span><br><span class="line"></span><br><span class="line"> 		<span class="comment">// Execute the module function</span></span><br><span class="line"> 		modules[moduleId].<span class="title function_">call</span>(<span class="variable language_">module</span>.<span class="property">exports</span>, <span class="variable language_">module</span>, <span class="variable language_">module</span>.<span class="property">exports</span>, __webpack_require__);</span><br><span class="line"></span><br><span class="line"> 		<span class="comment">// Flag the module as loaded</span></span><br><span class="line"> 		<span class="variable language_">module</span>.<span class="property">l</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"> 		<span class="comment">// Return the exports of the module</span></span><br><span class="line"> 		<span class="keyword">return</span> <span class="variable language_">module</span>.<span class="property">exports</span>;</span><br><span class="line"> 	&#125;</span><br><span class="line"></span><br><span class="line"> 	<span class="comment">// expose the modules object (__webpack_modules__)</span></span><br><span class="line"> 	__webpack_require__.<span class="property">m</span> = modules;</span><br><span class="line"></span><br><span class="line"> 	<span class="comment">// expose the module cache</span></span><br><span class="line"> 	__webpack_require__.<span class="property">c</span> = installedModules;</span><br><span class="line"></span><br><span class="line"> 	<span class="comment">// define getter function for harmony exports</span></span><br><span class="line"> 	__webpack_require__.<span class="property">d</span> = <span class="keyword">function</span>(<span class="params"><span class="built_in">exports</span>, name, getter</span>) &#123;</span><br><span class="line"> 		<span class="keyword">if</span>(!__webpack_require__.<span class="title function_">o</span>(<span class="built_in">exports</span>, name)) &#123;</span><br><span class="line"> 			<span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="built_in">exports</span>, name, &#123; <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">get</span>: getter &#125;);</span><br><span class="line"> 		&#125;</span><br><span class="line"> 	&#125;;</span><br><span class="line"></span><br><span class="line"> 	<span class="comment">// define __esModule on exports</span></span><br><span class="line"> 	__webpack_require__.<span class="property">r</span> = <span class="keyword">function</span>(<span class="params"><span class="built_in">exports</span></span>) &#123;</span><br><span class="line"> 		<span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="title class_">Symbol</span> !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="title class_">Symbol</span>.<span class="property">toStringTag</span>) &#123;</span><br><span class="line"> 			<span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="built_in">exports</span>, <span class="title class_">Symbol</span>.<span class="property">toStringTag</span>, &#123; <span class="attr">value</span>: <span class="string">&#x27;Module&#x27;</span> &#125;);</span><br><span class="line"> 		&#125;</span><br><span class="line"> 		<span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="built_in">exports</span>, <span class="string">&#x27;__esModule&#x27;</span>, &#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"> 	&#125;;</span><br><span class="line"></span><br><span class="line"> 	__webpack_require__.<span class="property">t</span> = <span class="keyword">function</span>(<span class="params">value, mode</span>) &#123;</span><br><span class="line"> 		<span class="keyword">if</span>(mode &amp; <span class="number">1</span>) value = <span class="title function_">__webpack_require__</span>(value);</span><br><span class="line"> 		<span class="keyword">if</span>(mode &amp; <span class="number">8</span>) <span class="keyword">return</span> value;</span><br><span class="line"> 		<span class="keyword">if</span>((mode &amp; <span class="number">4</span>) &amp;&amp; <span class="keyword">typeof</span> value === <span class="string">&#x27;object&#x27;</span> &amp;&amp; value &amp;&amp; value.<span class="property">__esModule</span>) <span class="keyword">return</span> value;</span><br><span class="line"> 		<span class="keyword">var</span> ns = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line"> 		__webpack_require__.<span class="title function_">r</span>(ns);</span><br><span class="line"> 		<span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(ns, <span class="string">&#x27;default&#x27;</span>, &#123; <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">value</span>: value &#125;);</span><br><span class="line"> 		<span class="keyword">if</span>(mode &amp; <span class="number">2</span> &amp;&amp; <span class="keyword">typeof</span> value != <span class="string">&#x27;string&#x27;</span>) <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> value) __webpack_require__.<span class="title function_">d</span>(ns, key, <span class="keyword">function</span>(<span class="params">key</span>) &#123; <span class="keyword">return</span> value[key]; &#125;.<span class="title function_">bind</span>(<span class="literal">null</span>, key));</span><br><span class="line"> 		<span class="keyword">return</span> ns;</span><br><span class="line"> 	&#125;;</span><br><span class="line"></span><br><span class="line"> 	<span class="comment">// getDefaultExport function for compatibility with non-harmony modules</span></span><br><span class="line"> 	__webpack_require__.<span class="property">n</span> = <span class="keyword">function</span>(<span class="params"><span class="variable language_">module</span></span>) &#123;</span><br><span class="line"> 		<span class="keyword">var</span> getter = <span class="variable language_">module</span> &amp;&amp; <span class="variable language_">module</span>.<span class="property">__esModule</span> ?</span><br><span class="line"> 			<span class="keyword">function</span> <span class="title function_">getDefault</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="variable language_">module</span>[<span class="string">&#x27;default&#x27;</span>]; &#125; :</span><br><span class="line"> 			<span class="keyword">function</span> <span class="title function_">getModuleExports</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="variable language_">module</span>; &#125;;</span><br><span class="line"> 		__webpack_require__.<span class="title function_">d</span>(getter, <span class="string">&#x27;a&#x27;</span>, getter);</span><br><span class="line"> 		<span class="keyword">return</span> getter;</span><br><span class="line"> 	&#125;;</span><br><span class="line"></span><br><span class="line"> 	<span class="comment">// Object.prototype.hasOwnProperty.call</span></span><br><span class="line"> 	__webpack_require__.<span class="property">o</span> = <span class="keyword">function</span>(<span class="params">object, property</span>) &#123; <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(object, property); &#125;;</span><br><span class="line"></span><br><span class="line"> 	<span class="comment">// __webpack_public_path__</span></span><br><span class="line"> 	__webpack_require__.<span class="property">p</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 	<span class="comment">// Load entry module and return exports</span></span><br><span class="line"> 	<span class="keyword">return</span> <span class="title function_">__webpack_require__</span>(__webpack_require__.<span class="property">s</span> = <span class="string">&quot;&lt;%-entry%&gt;&quot;</span>);</span><br><span class="line"> &#125;)</span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"> (&#123;</span><br><span class="line">&lt;% <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> modules) &#123;%&gt; </span><br><span class="line"><span class="string">&quot;&lt;%-key%&gt;&quot;</span>:(<span class="keyword">function</span>(<span class="params"><span class="variable language_">module</span>, <span class="built_in">exports</span>, __webpack_require__</span>) &#123;</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">`&lt;%-modules[key]%&gt;`</span>);</span><br><span class="line">    &#125;),</span><br><span class="line">    &lt;% &#125; %&gt; </span><br><span class="line">     &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/babel-parser">代码转成抽象语法树AST @babel&#x2F;parser</a><br><a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/babel-traverse">require替换成__webpack_require__ @babel&#x2F;traverse</a><br><a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/babel-generator#docsNav">AST树转换为code @babel&#x2F;generator</a><br><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/ejs">模板文件 ejs</a></p>
<h4 id="webpack的loader实现步骤"><a href="#webpack的loader实现步骤" class="headerlink" title="webpack的loader实现步骤"></a>webpack的loader实现步骤</h4><ul>
<li>读取配置文件webpack.config.js中的module.rules，倒序迭代</li>
<li>根据正则匹配不同的文件，批量导入并执行loader函数</li>
<li>返回处理后的代码</li>
</ul>
<h4 id="webpack的plugin实现步骤"><a href="#webpack的plugin实现步骤" class="headerlink" title="webpack的plugin实现步骤"></a>webpack的plugin实现步骤</h4><ul>
<li>写一个js命名的函数，然后导出该函数</li>
<li>在插件函数原型上定义apply方法</li>
<li>指定一个绑定到webpack自身的事件钩子</li>
<li>处理webpack内部实例的特定数据</li>
<li>功能完成后调用webpack提供的回调</li>
</ul>
<p>webpack借助tapable（类似node中event模块）实现了钩子</p>
<h3 id="完整的demo"><a href="#完整的demo" class="headerlink" title="完整的demo"></a>完整的demo</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line">-------------------bundle.<span class="property">js</span>---------------</span><br><span class="line">#!<span class="regexp">/usr/</span>bin/env node</span><br><span class="line"><span class="comment">// console.log(&quot;bunlde脚本执行&quot;);</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(path.<span class="title function_">resolve</span>(<span class="string">&quot;bundle.config.js&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(config);  // 读取bundle.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Compiler</span> = <span class="built_in">require</span>(<span class="string">&quot;../lib/compiler.js&quot;</span>)  <span class="comment">// 编译类</span></span><br><span class="line"><span class="comment">// console.log(Compiler)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Compiler</span>(config).<span class="title function_">start</span>();</span><br><span class="line"></span><br><span class="line">-------------------compiler.<span class="property">js</span>------------------------</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">&quot;@babel/parser&quot;</span>);  <span class="comment">// 用来转换抽象语法树AST</span></span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">&quot;@babel/traverse&quot;</span>).<span class="property">default</span>;  <span class="comment">// require替换成__webpack_require__</span></span><br><span class="line"><span class="keyword">const</span> generator = <span class="built_in">require</span>(<span class="string">&quot;@babel/generator&quot;</span>).<span class="property">default</span>;  <span class="comment">// 读取代码内容</span></span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&quot;ejs&quot;</span>);   <span class="comment">// ejs模板</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">SyncHook</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;tapable&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">config</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">config</span> = config;   <span class="comment">// 配置文件</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">entry</span> = config.<span class="property">entry</span>;  <span class="comment">// 入口文件</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">root</span> = process.<span class="title function_">cwd</span>();   <span class="comment">// 获取执行根目录</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">modules</span> = &#123;&#125;;    <span class="comment">// 存储数据结构：&#123;&quot;./src/index.js&quot;: &quot;code...&quot;&#125; </span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">rules</span> = config.<span class="property">module</span>.<span class="property">rules</span>;   <span class="comment">// 存储loaders</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化生命周期钩子</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">            <span class="attr">compile</span>: <span class="keyword">new</span> <span class="title class_">SyncHook</span>(),</span><br><span class="line">            <span class="attr">afterCompile</span>: <span class="keyword">new</span> <span class="title class_">SyncHook</span>(),</span><br><span class="line">            <span class="attr">emit</span>: <span class="keyword">new</span> <span class="title class_">SyncHook</span>([<span class="string">&quot;data&quot;</span>]),</span><br><span class="line">            <span class="attr">afterEmit</span>: <span class="keyword">new</span> <span class="title class_">SyncHook</span>(),</span><br><span class="line">            <span class="attr">done</span>: <span class="keyword">new</span> <span class="title class_">SyncHook</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 执行plugin</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(<span class="variable language_">this</span>.<span class="property">config</span>.<span class="property">plugins</span>)) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">config</span>.<span class="property">plugins</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">plugin</span>=&gt;</span> &#123;</span><br><span class="line">                plugin.<span class="title function_">apply</span>(<span class="variable language_">this</span>);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 读取代码</span></span><br><span class="line">    <span class="title function_">getSource</span>(<span class="params">filepath</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> fs.<span class="title function_">readFileSync</span>(filepath, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 分析模块代码</span></span><br><span class="line">    <span class="title function_">depAnalyes</span>(<span class="params">modulePath</span>) &#123;</span><br><span class="line">        <span class="comment">//2.  获得入口文件内容</span></span><br><span class="line">        <span class="keyword">let</span> source = <span class="variable language_">this</span>.<span class="title function_">getSource</span>(modulePath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 读取rules（webpack的loader）</span></span><br><span class="line">        <span class="keyword">let</span> rulesLength = <span class="variable language_">this</span>.<span class="property">rules</span>.<span class="property">length</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = rulesLength -<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">let</span> &#123; test, use &#125; = <span class="variable language_">this</span>.<span class="property">rules</span>[i];</span><br><span class="line">            <span class="keyword">if</span>(test.<span class="title function_">test</span>(modulePath)) &#123;</span><br><span class="line">                <span class="comment">// 判断use是否数组</span></span><br><span class="line">                <span class="keyword">if</span>(use <span class="keyword">instanceof</span> <span class="title class_">Array</span>) &#123; <span class="comment">// 数组  // &#123;test: /\.js$/, use: [ &quot;babel-loader&quot;, &quot;ts-loader&quot; ] &#125;</span></span><br><span class="line">                    <span class="keyword">let</span> useLength = use.<span class="property">length</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">let</span> j = useLength -<span class="number">1</span>; j &gt;=<span class="number">0</span>; j--) &#123;</span><br><span class="line">                        <span class="comment">// console.log(path.join(this.root, use[j]))</span></span><br><span class="line">                        <span class="keyword">let</span> loader = <span class="built_in">require</span>(path.<span class="title function_">join</span>(<span class="variable language_">this</span>.<span class="property">root</span>, use[j]));</span><br><span class="line">                        source = <span class="title function_">loader</span>(source)                 </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> use === <span class="string">&quot;string&quot;</span>) &#123; <span class="comment">// 字符串</span></span><br><span class="line">                    <span class="keyword">let</span> loader = <span class="built_in">require</span>(path.<span class="title function_">join</span>(<span class="variable language_">this</span>.<span class="property">root</span>, use));  <span class="comment">//&#123;test: /\.js$/, use: &quot;babel-loader&quot;&#125;</span></span><br><span class="line">                    source = <span class="title function_">loader</span>(source);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> use === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">                    <span class="keyword">let</span> loader = <span class="built_in">require</span>(path.<span class="title function_">join</span>(<span class="variable language_">this</span>.<span class="property">root</span>, use.<span class="property">loader</span>));  <span class="comment">// &#123;test: /\.js$/, use: &#123; loader: &quot;babel-loader&quot;&#125; &#125;</span></span><br><span class="line">                    source = <span class="title function_">loader</span>(source);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> dependencies = [];   <span class="comment">// 依赖数组</span></span><br><span class="line">        <span class="comment">// 3. 分析内容引入其他模块，使用@babel/parser转换成抽象语法树AST,</span></span><br><span class="line">        <span class="comment">//  查看AST抽象语法树地址：https://astexplorer.net/</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable constant_">AST</span> = parser.<span class="title function_">parse</span>(source, &#123;</span><br><span class="line">            <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 4. 找到代码require替换成__webpack_require__, type=CallExpression有require, @babel/traverse</span></span><br><span class="line">        <span class="title function_">traverse</span>(<span class="variable constant_">AST</span>, &#123;</span><br><span class="line">            <span class="title class_">CallExpression</span>: <span class="keyword">function</span>(<span class="params">p</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(p.<span class="property">node</span>.<span class="property">callee</span>.<span class="property">name</span> === <span class="string">&quot;require&quot;</span>) &#123;</span><br><span class="line">                    p.<span class="property">node</span>.<span class="property">callee</span>.<span class="property">name</span> = <span class="string">&quot;__webpack_require__&quot;</span>;</span><br><span class="line">                    <span class="comment">// 6.更改require中的路径</span></span><br><span class="line">                    <span class="keyword">let</span> val = p.<span class="property">node</span>.<span class="property">arguments</span>[<span class="number">0</span>].<span class="property">value</span>;</span><br><span class="line">                    <span class="keyword">let</span> value = <span class="string">&quot;./&quot;</span> + path.<span class="title function_">join</span>(<span class="string">&quot;./src&quot;</span>, val);</span><br><span class="line">                    p.<span class="property">node</span>.<span class="property">arguments</span>[<span class="number">0</span>].<span class="property">value</span> = value.<span class="title function_">replace</span>(<span class="regexp">/\\+/g</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">                    <span class="comment">// 7. 根据路径去加载路径下的内容，分析文件内容，将这个路径push到一个数组中</span></span><br><span class="line">                    dependencies.<span class="title function_">push</span>(p.<span class="property">node</span>.<span class="property">arguments</span>[<span class="number">0</span>].<span class="property">value</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// console.log(dependencies)</span></span><br><span class="line">        <span class="comment">// 8. 递归所有依赖</span></span><br><span class="line">        dependencies.<span class="title function_">forEach</span>(<span class="function"><span class="params">dep</span>=&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> newPath = path.<span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">root</span>, dep);</span><br><span class="line">            <span class="comment">// console.log(newPath)</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">depAnalyes</span>(newPath);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 9. 希望构建结果&#123;&quot;./src/index.js&quot;: &quot;code...&quot;&#125; </span></span><br><span class="line">        <span class="keyword">let</span> relativePath = path.<span class="title function_">relative</span>(<span class="variable language_">this</span>.<span class="property">root</span>, modulePath);</span><br><span class="line">        relativePath = <span class="string">&quot;./&quot;</span> + relativePath.<span class="title function_">replace</span>(<span class="regexp">/\\+/g</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">modules</span>[relativePath] = <span class="title function_">generator</span>(<span class="variable constant_">AST</span>).<span class="property">code</span>;  <span class="comment">// AST转换成code</span></span><br><span class="line">        <span class="comment">// console.log(this.modules)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 替换模板文件</span></span><br><span class="line">    <span class="title function_">emitFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> template = <span class="variable language_">this</span>.<span class="title function_">getSource</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;../template/template.ejs&quot;</span>));</span><br><span class="line">        <span class="keyword">let</span> result = ejs.<span class="title function_">render</span>(template, &#123;</span><br><span class="line">            <span class="attr">entry</span>: <span class="variable language_">this</span>.<span class="property">entry</span>,</span><br><span class="line">            <span class="attr">modules</span>: <span class="variable language_">this</span>.<span class="property">modules</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> outputPath = path.<span class="title function_">join</span>(<span class="variable language_">this</span>.<span class="property">config</span>.<span class="property">output</span>.<span class="property">path</span>, <span class="variable language_">this</span>.<span class="property">config</span>.<span class="property">output</span>.<span class="property">filename</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// console.log(outputPath);</span></span><br><span class="line">        <span class="comment">// console.log(result);</span></span><br><span class="line">        <span class="comment">// 写入文件</span></span><br><span class="line">        fs.<span class="title function_">writeFileSync</span>(outputPath, result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 编译入口</span></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(this.root, this.entry)</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">compile</span>.<span class="title function_">call</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">depAnalyes</span>(path.<span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">root</span>, <span class="variable language_">this</span>.<span class="property">entry</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">modules</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">emitFile</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">afterEmit</span>.<span class="title function_">call</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">done</span>.<span class="title function_">call</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> =  <span class="title class_">Compiler</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------bundle.<span class="property">config</span>.<span class="property">js</span>----------------</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CopyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;./plugins/copy-webpack-plugin&quot;</span>); <span class="comment">// 自定义组件</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     test: /\.js/,</span></span><br><span class="line">            <span class="comment">//     use: [</span></span><br><span class="line">            <span class="comment">//         &quot;./loaders/loader1.js&quot;,</span></span><br><span class="line">            <span class="comment">//         &quot;./loaders/loader2.js&quot;,</span></span><br><span class="line">            <span class="comment">//         &quot;./loaders/loader3.js&quot;</span></span><br><span class="line">            <span class="comment">//     ]</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;app.js&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CopyWebpackPlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-------------------------copy-webpack-plugin.<span class="property">js</span>-----------------------</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CopyWebpackPlugin</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">//   console.log(options)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123; <span class="comment">// compiler是webpack运行实例</span></span><br><span class="line">        <span class="comment">// 同步</span></span><br><span class="line">        compiler.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">tap</span>(<span class="string">&quot;CopyWebpackPlugin&quot;</span>, <span class="function">(<span class="params">compilation</span>)=&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(compilation);</span><br><span class="line">            compilation.<span class="property">aabb</span> = <span class="string">&quot;hello alan&quot;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// 异步</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">      compiler.hooks.emit.tapAsync(&quot;CopyWebpackPlugin&quot;, function(compilation) &#123;</span></span><br><span class="line"><span class="comment">        console.log(&quot;hello world_____&quot;)</span></span><br><span class="line"><span class="comment">        compilation.assets[&quot;copy.txt&quot;] = &#123;</span></span><br><span class="line"><span class="comment">          source: function() &#123;</span></span><br><span class="line"><span class="comment">            return &quot;hello alan&quot;;</span></span><br><span class="line"><span class="comment">          &#125;,</span></span><br><span class="line"><span class="comment">          size: function() &#123;</span></span><br><span class="line"><span class="comment">            return 100</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        cb();</span></span><br><span class="line"><span class="comment">      &#125;)</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">CopyWebpackPlugin</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>




  </article>
</div>


    




</div>

<div class="footer-wrapper container">
  <footer class="footer clearfix">
    <div class="clearfix">
    <a href="https://alan89757.github.io" class="footer-logo">
      <i class="fa fa-github"></i>
    </a>
    <ul class="footer-social-link">
      <li>© 2023 Alan</li>
      <li><a href="https://alan89757.github.io">Home</a></li>
      
      <li><a target="_blank" rel="noopener" href="https://github.com/alan89757">Github</a></li>
      
    </ul>
    <!-- <div class="footer-theme-info">
      Theme <a target="_blank" rel="noopener" href="//github.com/sabrinaluo/hexo-theme-replica">Replica</a>
      by <a target="_blank" rel="noopener" href="//github.com/sabrinaluo">Alan</a> ❤ Powered by Hexo
    </div> -->
    </div>
    
  </footer>
</div>


<script>
  (function() {
    var cx = 'true';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>



<script src="/js/main.js"></script>

</body>
</html>
